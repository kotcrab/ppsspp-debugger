{"version":3,"sources":["components/common/FitModal.js","components/common/Field.js","components/common/Form.js","utils/timeouts.js","utils/format.js","components/CPU/BreakpointModal.js","utils/clipboard.js","components/CPU/DisasmContextMenu.js","components/CPU/DisasmBranchGuide.js","utils/dom.js","components/CPU/BreakpointIcon.js","components/CPU/DisasmLine.js","components/CPU/DisasmList.js","components/CPU/DisasmSearch.js","components/CPU/StatusBar.js","utils/listeners.js","components/CPU/Disasm.js","components/CPU/DisasmButtons.js","components/CPU/GotoBox.js","components/CPU/FuncList.js","components/CPU/RegList.js","components/CPU/RegPanel.js","components/CPU/VisualizeVFPU.js","components/CPU/LeftPanel.js","components/CPU.js","components/GPU.js","components/LogItem.js","components/Log.js","components/NotConnected.js","sdk/ppsspp.js","assets/logo.svg","components/App.js","registerServiceWorker.js","index.js"],"names":["FitModal","handleRequestClose","props","confirmClose","window","confirm","onClose","className","overlayClassName","onRequestClose","this","closeTimeoutMS","PureComponent","Field","handleChange","ev","onChange","component","target","prop","dataset","value","type","checked","setState","label","children","htmlFor","fieldID","renderInput","renderText","renderHex","renderRadio","renderCheckboxes","other","primary","fieldValue","id","pattern","title","options","map","option","name","disabled","state","displayName","constructor","undefined","Component","Form","action","classNames","onSubmit","heading","Buttons","saveHandler","onSave","saveButton","onClick","cancelButton","onCancel","propTypes","PropTypes","oneOfType","func","bool","node","Timeout","ms","cancel","handle","setTimeout","clearTimeout","toString08X","val","toString","toUpperCase","substr","typeOptions","operationOptions","actionOptions","BreakpointModal","cleanState","isOpen","derivedBreakpoint","cleanBreakpoint","address","size","condition","logFormat","read","write","change","enabled","log","e","operation","ppsspp","send","event","thread","currentThread","expression","breakpoint","then","deleteOld","saveNew","updateExisting","err","alert","message","preventDefault","uintValue","getEvent","cleanTimeout","start","Object","assign","editing","contentLabel","hasChanges","renderMemory","renderExecute","Fragment","compareTo","keys","find","key","prevProps","prevState","runEarly","Error","nextProps","userInitiated","listeners","getScratchpad","div","document","getElementById","createElement","style","width","height","opacity","position","top","left","pointerEvents","whiteSpace","body","appendChild","createScratchpad","copyText","text","scratchpad","textContent","textNode","firstChild","range","createRange","setStart","setEnd","length","selection","getSelection","oldRange","rangeCount","getRangeAt","removeAllRanges","addRange","execCommand","prompt","hasClosestMatch","selector","matches","parentNode","Element","prototype","msMatchesSelector","addEventListener","collapsed","listener","activeElement","result","handler","test","navigator","platform","clipboardData","setData","replace","DisasmContextMenu","handleCopyAddress","data","line","focus","handleCopyHex","getSelectedLines","macroEncoding","join","encoding","handleCopyDisasm","getSelectedDisasm","handleAssemble","assembleInstruction","catch","handleRunUntil","handleJumpPC","handleToggleBreakpoint","toggleBreakpoint","handleFollowBranch","followBranch","handleTodo","console","trigger","stepping","branch","relevantData","divider","connectMenu","DisasmBranchGuide","pos","calcPos","lineHeight","classes","selected","xmlns","d","buildPath","guide","yCenter","Math","floor","trailingEdge","sourceEdge","arrowEdge","path","push","direction","bottom","end","findAddressOffset","right","lane","down","off","offsets","isSubsetBounds","bounds","parentBounds","ensureInView","windowBounds","innerHeight","innerWidth","rect","getBoundingClientRect","HTMLElement","getComputedStyle","overflows","overflow","overflowX","overflowY","indexOf","isInView","scrollIntoView","contextMenuStatus","hasContextMenu","BreakpointIcon","viewBox","DisasmLine","ref","React","createRef","focused","cursor","isCurrentPC","mapData","current","attributes","onDoubleClick","tabIndex","contextmenu","renderTag","collect","holdToDisplay","backgroundColor","data-address","renderAddress","highlight","params","highlightParams","renderConditional","symbol","addressHex","displaySymbols","conditionMet","before","after","fullText","toLowerCase","matchLength","beforeLength","split","toHighlight","param","includes","button","needsScroll","triggerNode","block","lineNode","querySelector","DisasmList","mouseDown","lineOffsets","pendingLineParams","selectedLineParams","prevLines","prevSelectionTop","prevSelectionBottom","onCopy","cursorRef","focusTimeout","paramsTimeout","events","onMouseDownCapture","onMouseDown","onMouseUpCapture","onMouseUp","onMouseMove","onKeyDown","onBlur","onFocusChange","onFocus","lines","renderLine","branchGuides","renderBranchGuide","isLineSelected","shouldHighlight","highlightText","shouldHighlightParams","String","match","parts","some","part","addressBoundingTop","filter","l","update","reset","mouseEventToLine","updateCursor","applySelection","buttons","modifiers","ctrlKey","metaKey","altKey","shiftKey","dist","visibleLines","lineIndex","findCursorLineIndex","newIndex","min","max","applyScroll","findCursorLine","updateDisplaySymbols","searchPrompt","searchNext","promptGoto","editBreakpoint","selectionTop","selectionBottom","updateSelection","y","pageY","pageYOffset","index","addr","i","addressSize","forEach","selectedLines","bind","values","linesChanged","selectionChanged","offsetsUpdate","calcOffsets","selectedUpdate","getSelectedLineParams","DisasmSearch","updateSearchString","handleNext","handleCancel","handleKeyDown","searchString","inProgress","hidden","placeholder","role","StatusBar","renderLeftStatus","function","dataAccess","renderDataAccess","renderBranch","stringValue","renderString","renderDataSymbol","dataSymbol","status","valueSymbol","toString04X","targetAddress","JSON","stringify","changeCallbacks_","ppsspp_","connected_","connected","callback","remove","splice","onConnectionChange","handlers","hasOwnProperty","onConnection","listen","MIN_BUFFER","Disasm","wantDisplaySymbols","searchInProgress","editingBreakpoint","jumpStack","needsOffsetFix","updatesCancel","updatesSequence","Promise","resolve","lastSearch","minBuffer","maxBuffer","updateDisasmNow","branchAddresses","unlabeledBranches","b","firstLine","flag","gotoAddress","pop","pc","startCode","code","writeInstruction","nextAddress","updateDisasm","assignment","keep","breakpointAddress","bp","breakpoints","closeEditBreakpoint","snap","searchDisasm","cont","continueLast","searchCancel","last","cancelState","finally","listRef","ensureCursorInView","searchRef","scrollTop","onScroll","onDragStart","started","renderContextMenu","renderNotStarted","centerAddress","listeners_","hasRange","category","register","forget","snapshot","disasmChange","updateDisasmRange","setInitialPC","foundLine","clientHeight","jumpMarker","list","newRange","updateRange","defaultBuffer","count","cleanupBranchGuides","unique","Map","set","bufferRange","bufferTop","bufferBottom","scrollHeight","visibleEachDirection","DisasmButtons","breakpointModalOpen","lastThread","threads","handleGoBreak","updateCurrentThread","handleStepInto","handleStepOver","handleStepOut","threadID","handleNextHLE","handleThreadSelect","th","Number","handleBreakpointOpen","handleBreakpointClose","showNavTray","paused","renderThreadList","renderThread","isCurrent","updateThreadList","resetCurrentThread","GotoBox","handleSubmit","gotoDisasm","handlePC","jumpToReg","handleRA","autoComplete","promptGotoMarker","select","FuncList","loading","rowHeight","functions","filteredFunctions","renderSizedList","rowRenderer","renderFunc","rowCount","handleFilter","applyFilter","handleClick","renderList","updateList","measureHeight","sort","a","localeCompare","RegList","registerNames","reg","renderReg","cat","format","ddClasses","changed","uintValues","floatValues","uintValuesLast","RegPanel","categories","handleViewMemory","handleViewDisassembly","handleCopyReg","regNode","handleChangeReg","prevValue","registerName","newValue","packet","renderTabs","c","updateRegs","updateReg","keepLast","hasPrev","prevCat","floatValuesLast","error","replaceCopy","arr","item","slice","concat","floatValue","VisualizeVFPU","handleFormat","matrices","m","renderMatrix","renderColumn","renderValue","r","LeftPanel","vfpuModalOpen","everShownFuncs","handleSelect","handleVFPUOpen","handleVFPUClose","onSelect","forceRender","CPU","lastTicks","ticks","navTray","hideNavTray","updateInitialPC","commonProps","disasmProps","onStepping","GPU","recording","beginRecord","setAttribute","href","uri","click","removeChild","LogItem","formatLogEvent","renderInternal","makeClassName","timestamp","header","channel","level","Log","items","divRef","renderItem","newItem","itemWithId","onError","addLogItem","onLogEvent","NotConnected","connecting","elements","connect","NoResponseEvents","ErrorLevels","PPSSPP","socket_","pendingTickets_","reject","fetch","response","json","listing","tryNextEndpoint_","setupSocket_","specificError","originalError","possibleSocket","WebSocket","onopen","onclose","failAllPending_","close","eventName","ticket","makeTicket_","originalMessage","onmessage","parse","handleError_","handled","handleTicket_","handleMessage_","endpoint","ip","p","executeHandlers_","random","versionInfo","process","version","App","handleAutoConnect","autoConnect","handleDisconnect","disconnect","logRef","updateTitle","game","originalTitle","init","to","src","logo","alt","renderContent","testing","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","render","Modal","setAppElement","URL","origin","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.15412881.chunk.js","sourcesContent":["import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from 'react-modal';\r\nimport '../ext/react-modal.css';\r\n\r\nclass FitModal extends PureComponent {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"ReactModal__FitContent\" overlayClassName=\"ReactModal__FitOverlay\"\r\n\t\t\t\tonRequestClose={this.handleRequestClose}\r\n\t\t\t\tcloseTimeoutMS={150}\r\n\t\t\t\t{...this.props}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\thandleRequestClose = () => {\r\n\t\tif (this.props.confirmClose) {\r\n\t\t\tif (!window.confirm(this.props.confirmClose)) {\r\n\t\t\t\t// Don't close.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.props.onClose();\r\n\t}\r\n}\r\n\r\nFitModal.propTypes = {\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tonClose: PropTypes.func.isRequired,\r\n\tconfirmClose: PropTypes.string,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default FitModal;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nclass Field extends Component {\r\n\trender() {\r\n\t\tconst { label, children } = this.props;\r\n\t\treturn (\r\n\t\t\t<div className=\"Field\">\r\n\t\t\t\t<label className=\"Field__label\" htmlFor={this.fieldID()}>{label}</label>\r\n\t\t\t\t{this.renderInput()}\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderInput() {\r\n\t\tif (this.props.type === 'text') {\r\n\t\t\treturn this.renderText();\r\n\t\t} else if (this.props.type === 'hex') {\r\n\t\t\treturn this.renderHex();\r\n\t\t} else if (this.props.type === 'radio') {\r\n\t\t\treturn this.renderRadio();\r\n\t\t} else if (this.props.type === 'checkboxes') {\r\n\t\t\treturn this.renderCheckboxes();\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\trenderText(other = {}) {\r\n\t\tlet { label, type, children, onChange, component, prop, ...primary } = this.props;\r\n\t\tprimary.value = this.fieldValue();\r\n\t\treturn <input type=\"text\" id={this.fieldID()} onChange={this.handleChange} {...primary} {...other} />;\r\n\t}\r\n\r\n\trenderHex() {\r\n\t\treturn this.renderText({ pattern: '(0x)?[0-9A-Fa-f]+', title: 'Hexadecimal value' });\r\n\t}\r\n\r\n\trenderRadio() {\r\n\t\tconst value = this.fieldValue();\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\tname: this.fieldID(),\r\n\t\t\t\tvalue: option.value,\r\n\t\t\t\tchecked: value === option.value,\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"radio\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\trenderCheckboxes() {\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\t'data-prop': option.value,\r\n\t\t\t\tchecked: this.props.component.state[option.value],\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"checkbox\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tfieldID() {\r\n\t\tconst { id, component, prop } = this.props;\r\n\t\tif (!id && component && prop) {\r\n\t\t\treturn (component.displayName || component.constructor.name) + '__' + prop;\r\n\t\t}\r\n\t\treturn id;\r\n\t}\r\n\r\n\tfieldValue() {\r\n\t\tconst { value, component, prop } = this.props;\r\n\t\tif (value === undefined && component && prop) {\r\n\t\t\treturn component.state[prop];\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tif (this.props.onChange) {\r\n\t\t\tthis.props.onChange(ev);\r\n\t\t} else if (this.props.component) {\r\n\t\t\tconst { target } = ev;\r\n\t\t\tconst prop = target.dataset.prop || this.props.prop;\r\n\t\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\r\n\t\t\tthis.props.component.setState({ [prop]: value });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nField.propTypes = {\r\n\tid: PropTypes.string,\r\n\tlabel: PropTypes.node.isRequired,\r\n\ttype: PropTypes.oneOf(['text', 'hex', 'radio', 'checkboxes']),\r\n\tcomponent: PropTypes.object,\r\n\tvalue: PropTypes.string,\r\n\tprop: PropTypes.string,\r\n\toptions: PropTypes.arrayOf(PropTypes.shape({\r\n\t\tlabel: PropTypes.string.isRequired,\r\n\t\tvalue: PropTypes.string.isRequired,\r\n\t})),\r\n\tdisabled: PropTypes.bool,\r\n\tonChange: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Field;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\nimport './Form.css';\r\n\r\nfunction Form(props) {\r\n\t/* eslint no-script-url: \"off\" */\r\n\treturn (\r\n\t\t<form action=\"#\" className={classNames(props.className, 'Form')} onSubmit={props.onSubmit}>\r\n\t\t\t{props.heading ? <h2 className=\"Form__heading\">{props.heading}</h2> : null}\r\n\t\t\t{props.children}\r\n\t\t</form>\r\n\t);\r\n}\r\n\r\nForm.propTypes = {\r\n\tonSubmit: PropTypes.func.isRequired,\r\n\tclassName: PropTypes.string,\r\n\tchildren: PropTypes.node.isRequired,\r\n};\r\n\r\nForm.Buttons = function (props) {\r\n\tconst saveHandler = props.onSave !== true ? props.onSave : undefined;\r\n\tconst saveButton = props.onSave ? <button onClick={saveHandler}>Save</button> : null;\r\n\tconst cancelButton = props.onCancel ? <button type=\"button\" onClick={props.onCancel}>Cancel</button> : null;\r\n\r\n\treturn (\r\n\t\t<div className=\"Form__buttons\">\r\n\t\t\t{props.children}\r\n\t\t\t{saveButton}\r\n\t\t\t{cancelButton}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nForm.Buttons.propTypes = {\r\n\tonSave: PropTypes.oneOfType([PropTypes.func, PropTypes.bool]),\r\n\tonCancel: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Form;\r\n","export class Timeout {\r\n\thandle;\r\n\tfunc;\r\n\tms;\r\n\r\n\tconstructor(func, ms) {\r\n\t\tthis.func = func;\r\n\t\tthis.ms = ms;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.cancel();\r\n\t\tthis.handle = setTimeout(() => {\r\n\t\t\tthis.handle = null;\r\n\t\t\tthis.func();\r\n\t\t}, this.ms);\r\n\t}\r\n\r\n\treset(func) {\r\n\t\tthis.func = func;\r\n\t}\r\n\r\n\trunEarly() {\r\n\t\tif (this.handle) {\r\n\t\t\tthis.cancel();\r\n\t\t\tthis.func();\r\n\t\t}\r\n\t}\r\n\r\n\tcancel() {\r\n\t\tif (this.handle !== null) {\r\n\t\t\tclearTimeout(this.handle);\r\n\t\t\tthis.handle = null;\r\n\t\t}\r\n\t}\r\n}\r\n","export function toString08X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00000000' + hex).substr(-8);\r\n}\r\n\r\nexport function toString04X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('0000' + hex).substr(-4);\r\n}\r\n\r\nexport function toString02X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00' + hex).substr(-2);\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport Field from '../common/Field';\r\nimport Form from '../common/Form';\r\nimport { Timeout } from '../../utils/timeouts';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './BreakpointModal.css';\r\n\r\nconst typeOptions = [\r\n\t{ label: 'Memory', value: 'memory' },\r\n\t{ label: 'Execute', value: 'execute' },\r\n];\r\n\r\nconst operationOptions = [\r\n\t{ label: 'Read', value: 'read' },\r\n\t{ label: 'Write', value: 'write' },\r\n\t{ label: 'On change', value: 'change' },\r\n];\r\n\r\nconst actionOptions = [\r\n\t{ label: 'Break', value: 'enabled' },\r\n\t{ label: 'Log', value: 'log' },\r\n];\r\n\r\nclass BreakpointModal extends PureComponent {\r\n\tstate = {};\r\n\tcleanState = {\r\n\t\tisOpen: false,\r\n\t\tderivedBreakpoint: null,\r\n\t};\r\n\tcleanBreakpoint = {\r\n\t\ttype: 'memory',\r\n\t\taddress: '',\r\n\t\tsize: '0x00000001',\r\n\t\tcondition: '',\r\n\t\tlogFormat: '',\r\n\t\tread: true,\r\n\t\twrite: true,\r\n\t\tchange: false,\r\n\t\tenabled: true,\r\n\t\tlog: true,\r\n\t};\r\n\tcleanTimeout;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tObject.assign(this.state, { ...this.cleanState, ...this.cleanBreakpoint, ...props.breakpoint });\r\n\r\n\t\tthis.cleanTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ ...this.cleanState, ...this.cleanBreakpoint, ...this.props.breakpoint });\r\n\t\t}, 200);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst editing = this.props.breakpoint !== null;\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal\r\n\t\t\t\tcontentLabel=\"Breakpoint settings\"\r\n\t\t\t\tisOpen={this.props.isOpen}\r\n\t\t\t\tonClose={this.onClose}\r\n\t\t\t\tconfirmClose={this.hasChanges() ? 'Discard changes?' : null}\r\n\t\t\t>\r\n\t\t\t\t<Form heading={editing ? 'Edit Breakpoint' : 'Create Breakpoint'} onSubmit={this.onSave} className=\"BreakpointModal\">\r\n\t\t\t\t\t<Field type=\"radio\" label=\"Type\" options={typeOptions} prop=\"type\" component={this} />\r\n\t\t\t\t\t<Field type=\"text\" label=\"Address\" prop=\"address\" component={this} />\r\n\t\t\t\t\t{this.renderMemory()}\r\n\t\t\t\t\t{this.renderExecute()}\r\n\t\t\t\t\t<Field type=\"text\" label=\"Log format\" prop=\"logFormat\" component={this} disabled={!this.state.log} />\r\n\t\t\t\t\t<Field type=\"checkboxes\" label=\"Actions\" options={actionOptions} component={this} />\r\n\r\n\t\t\t\t\t<Form.Buttons onSave={true} onCancel={this.onClose} />\r\n\t\t\t\t</Form>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMemory() {\r\n\t\tif (this.state.type !== 'memory') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Field type=\"hex\" label=\"Size\" prop=\"size\" component={this} />\r\n\t\t\t\t<Field type=\"checkboxes\" label=\"Operations\" options={operationOptions} component={this} />\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\trenderExecute() {\r\n\t\tif (this.state.type !== 'execute') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Field type=\"text\" label=\"Condition\" prop=\"condition\" component={this} />\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\thasChanges() {\r\n\t\tconst compareTo = this.state.derivedBreakpoint || this.cleanBreakpoint;\r\n\t\treturn Object.keys(compareTo).find(key => this.state[key] !== compareTo[key]) !== undefined;\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.isOpen && this.cleanTimeout != null) {\r\n\t\t\tthis.cleanTimeout.runEarly();\r\n\t\t}\r\n\t}\r\n\r\n\tonSave = (e) => {\r\n\t\tlet operation = this.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.evaluate',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\texpression: this.state.address,\r\n\t\t});\r\n\r\n\t\tif (this.props.breakpoint !== null) {\r\n\t\t\tconst { derivedBreakpoint, address, size, type } = this.state;\r\n\t\t\tif (type !== derivedBreakpoint.type || derivedBreakpoint.address !== address) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else if (type === 'memory' && derivedBreakpoint.size !== size) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else {\r\n\t\t\t\toperation = operation.then(this.updateExisting);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\toperation = operation.then(this.saveNew);\r\n\t\t}\r\n\r\n\t\toperation.then(this.onClose, err => {\r\n\t\t\twindow.alert(err.message);\r\n\t\t});\r\n\r\n\t\te.preventDefault();\r\n\t}\r\n\r\n\tsaveNew = ({ uintValue }) => {\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'add'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteOld = ({ uintValue }) => {\r\n\t\t// This is used when changing the breakpoint type.\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.props.breakpoint.type, 'remove'),\r\n\t\t\taddress: this.props.breakpoint.address,\r\n\t\t}).then(() => {\r\n\t\t\t// Return the original new address for easy sequencing.\r\n\t\t\treturn { uintValue };\r\n\t\t});\r\n\t}\r\n\r\n\tupdateExisting = ({ uintValue }) => {\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'update'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tgetEvent(type, event) {\r\n\t\tif (type === 'execute') {\r\n\t\t\treturn 'cpu.breakpoint.' + event;\r\n\t\t} else if (type === 'memory') {\r\n\t\t\treturn 'memory.breakpoint.' + event;\r\n\t\t} else {\r\n\t\t\tthrow new Error('Unexpected type: ' + type);\r\n\t\t}\r\n\t}\r\n\r\n\tonClose = () => {\r\n\t\tthis.cleanTimeout.start();\r\n\t\tthis.props.onClose();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tif (nextProps.isOpen && !prevState.isOpen) {\r\n\t\t\tlet derivedBreakpoint = nextProps.breakpoint;\r\n\t\t\tif (derivedBreakpoint) {\r\n\t\t\t\t// This is the \"derived\" unchanged state for the \"Discard changes?\" prompt, and initial state.\r\n\t\t\t\tderivedBreakpoint.address = '0x' + toString08X(derivedBreakpoint.address);\r\n\t\t\t\tderivedBreakpoint.condition = derivedBreakpoint.condition || '';\r\n\t\t\t\tderivedBreakpoint.logFormat = derivedBreakpoint.logFormat || '';\r\n\t\t\t}\r\n\t\t\treturn { isOpen: true, ...derivedBreakpoint, derivedBreakpoint };\r\n\t\t}\r\n\t\tif (!nextProps.isOpen && prevState.derivedBreakpoint) {\r\n\t\t\treturn { derivedBreakpoint: null };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nBreakpointModal.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\tbreakpoint: PropTypes.shape({\r\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}),\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default BreakpointModal;\r\n","// We set this to false when we trigger one.\r\nlet userInitiated = true;\r\n\r\nlet listeners = [];\r\n\r\nfunction createScratchpad() {\r\n\tconst div = document.createElement('div');\r\n\tdiv.id = 'clipboard-scratchpad';\r\n\tdiv.style.width = 1;\r\n\tdiv.style.height = 1;\r\n\tdiv.style.opacity = 0;\r\n\tdiv.style.position = 'absolute';\r\n\tdiv.style.top = 0;\r\n\tdiv.style.left = 0;\r\n\tdiv.style.pointerEvents = 'none';\r\n\tdiv.style.whiteSpace = 'pre';\r\n\tdocument.body.appendChild(div);\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction getScratchpad() {\r\n\tconst div = document.getElementById('clipboard-scratchpad');\r\n\tif (!div) {\r\n\t\treturn createScratchpad();\r\n\t}\r\n\treturn div;\r\n}\r\n\r\nexport function copyText(text) {\r\n\tuserInitiated = false;\r\n\r\n\ttry {\r\n\t\tconst scratchpad = getScratchpad();\r\n\t\tscratchpad.textContent = text;\r\n\r\n\t\tconst textNode = scratchpad.firstChild;\r\n\t\tconst range = document.createRange();\r\n\t\trange.setStart(textNode, 0);\r\n\t\trange.setEnd(textNode, text.length);\r\n\r\n\t\tconst selection = window.getSelection();\r\n\t\tconst oldRange = selection.rangeCount !== 0 ? selection.getRangeAt(0) : null;\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\r\n\t\ttry {\r\n\t\t\tdocument.execCommand('copy');\r\n\t\t} catch (e) {\r\n\t\t\twindow.prompt('Use Ctrl-C or Command-C to copy', text);\r\n\t\t}\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tif (oldRange) {\r\n\t\t\tselection.addRange(oldRange);\r\n\t\t}\r\n\t} finally {\r\n\t\tuserInitiated = true;\r\n\t}\r\n}\r\n\r\nexport function listenCopy(selector, handler) {\r\n\tlisteners.push({ selector, handler });\r\n}\r\n\r\nexport function forgetCopy(selector, handler) {\r\n\tlisteners = listeners.filter(l => l.selector !== selector && l.handler !== handler);\r\n}\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = Element.prototype.msMatchesSelector;\r\n}\r\n\r\nfunction hasClosestMatch(node, selector) {\r\n\twhile (node && node !== document) {\r\n\t\tif (node.matches(selector)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tnode = node.parentNode;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\ndocument.addEventListener('copy', (ev) => {\r\n\tconst range = document.getSelection().rangeCount !== 0 ? document.getSelection().getRangeAt(0) : null;\r\n\tif ((range && !range.collapsed) || !userInitiated) {\r\n\t\t// Skip if the user has anything actually selected, or if we triggered this 'copy' command.\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor (let listener of listeners) {\r\n\t\tif (!hasClosestMatch(document.activeElement, listener.selector)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst result = listener.handler(ev);\r\n\t\tif (result) {\r\n\t\t\t// Unfortunate, but newline conversion isn't automatic...\r\n\t\t\tif (/win/i.test(window.navigator.platform)) {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result.replace(/\\n/g, '\\r\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result);\r\n\t\t\t}\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n});\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem, connectMenu } from 'react-contextmenu';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\n\r\nclass DisasmContextMenu extends PureComponent {\r\n\trender() {\r\n\t\tconst { id, trigger } = this.props;\r\n\t\tconst disabled = !this.props.stepping;\r\n\t\tconst line = trigger && trigger.line;\r\n\r\n\t\tconst followBranch = line && (line.branch !== null || line.relevantData !== null || line.type === 'data');\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenu id={id}>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyAddress}>\r\n\t\t\t\t\tCopy Address\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyHex}>\r\n\t\t\t\t\tCopy Instruction (Hex)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyDisasm}>\r\n\t\t\t\t\tCopy Instruction (Disasm)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleAssemble}>\r\n\t\t\t\t\tAssemble Opcode...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleRunUntil}>\r\n\t\t\t\t\tRun to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleJumpPC}>\r\n\t\t\t\t\tJump to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleToggleBreakpoint}>\r\n\t\t\t\t\tToggle Breakpoint\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={!followBranch} onClick={this.handleFollowBranch}>\r\n\t\t\t\t\tFollow Branch\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_memory' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_jit' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Jit Compare\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem data={{ action: 'func_rename' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRename Function...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_remove' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRemove Function\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_add' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tAdd Function Here\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\thandleCopyAddress = (ev, data) => {\r\n\t\tcopyText(toString08X(data.line.address));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyHex = (ev, data) => {\r\n\t\tconst hexLines = this.props.getSelectedLines().map(line => {\r\n\t\t\t// Include each opcode of a macro if it's a macro.\r\n\t\t\treturn line.macroEncoding ? line.macroEncoding.map(toString08X).join(\"\\n\") : toString08X(line.encoding);\r\n\t\t});\r\n\t\tcopyText(hexLines.join(\"\\n\"));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyDisasm = (ev, data) => {\r\n\t\tconst lines = this.props.getSelectedDisasm();\r\n\t\tcopyText(lines);\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleAssemble = (ev, data) => {\r\n\t\t// Delay so the context menu can close before the prompt.\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.assembleInstruction(data.line, '').catch(() => {\r\n\t\t\t\t// Exception logged.\r\n\t\t\t});\r\n\t\t}, 0);\r\n\t}\r\n\r\n\thandleRunUntil = (ev, data) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.runUntil',\r\n\t\t\taddress: data.line.address,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleJumpPC = (ev, data) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\tname: 'pc',\r\n\t\t\tvalue: data.line.address,\r\n\t\t}).catch((err) => {\r\n\t\t\tthis.props.log('Failed to update PC: ' + err);\r\n\t\t});\r\n\t}\r\n\r\n\thandleToggleBreakpoint = (ev, data) => {\r\n\t\tthis.props.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\thandleFollowBranch = (ev, data) => {\r\n\t\tthis.props.followBranch(true, data.line);\r\n\t}\r\n\r\n\thandleTodo = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t\tdata.node.focus();\r\n\t}\r\n}\r\n\r\nDisasmContextMenu.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n\ttrigger: PropTypes.shape({\r\n\t\tline: PropTypes.shape({\r\n\t\t\ttype: PropTypes.string,\r\n\t\t\tbranch: PropTypes.object,\r\n\t\t\trelevantData: PropTypes.object,\r\n\t\t}),\r\n\t}),\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tgetSelectedLines: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connectMenu('disasm')(DisasmContextMenu);\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\n\r\nclass DisasmBranchGuide extends PureComponent {\r\n\trender() {\r\n\t\tconst pos = this.calcPos();\r\n\t\tif (pos === null || this.props.lineHeight === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst classes = classNames({\r\n\t\t\t'DisasmBranchGuide': true,\r\n\t\t\t'DisasmBranchGuide--selected': this.props.selected,\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classes} style={pos}>\r\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height={pos.height}>\r\n\t\t\t\t\t<path d={this.buildPath(pos.height)} />\r\n\t\t\t\t</svg>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tbuildPath(height) {\r\n\t\tconst { guide, range, lineHeight } = this.props;\r\n\t\tconst yCenter = Math.floor(lineHeight / 2) + 0.5;\r\n\r\n\t\t// Parts: trailing connects to outside view.\r\n\t\tconst trailingEdge = `m7.5,-${yCenter} l0,${lineHeight} m-7.5,-${lineHeight - yCenter}`;\r\n\t\tconst sourceEdge = 'm3,0 l5,0 m-8,0';\r\n\t\tconst arrowEdge = 'm5.5,-4 l-4,4 l4,4 m-3.5,-4 l6,0 m-8,0';\r\n\r\n\t\t// Start at the y center so our parts are reusable for top and bottom.\r\n\t\tlet path = ['M0,' + yCenter];\r\n\r\n\t\tif (guide.top < range.start) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'up') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\tpath.push('m7.5,0 l0,' + (height - lineHeight) + ' m-7.5,0');\r\n\r\n\t\tif (guide.bottom >= range.end) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'down') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\treturn path.join(' ');\r\n\t}\r\n\r\n\tcalcPos() {\r\n\t\tconst { guide } = this.props;\r\n\t\tconst top = this.findAddressOffset(guide.top, false);\r\n\t\tconst bottom = this.findAddressOffset(guide.bottom, true);\r\n\t\tif (top === null || bottom === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst right = (16 - guide.lane) * 8;\r\n\t\tconst height = bottom - top;\r\n\t\treturn { top, right, height };\r\n\t}\r\n\r\n\tfindAddressOffset(address, down) {\r\n\t\tconst { offsets, range } = this.props;\r\n\t\tif (address >= range.end) {\r\n\t\t\tif ((range.end - 4) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 4] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\tif ((range.end - 8) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 8] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet off;\r\n\t\tif (address < range.start && !down) {\r\n\t\t\toff = 0;\r\n\t\t} else if (address in offsets) {\r\n\t\t\toff = offsets[address];\r\n\t\t} else if (address - 4 in offsets) {\r\n\t\t\t// Inside a macro?\r\n\t\t\toff = offsets[address - 4];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn down ? off + this.props.lineHeight : off;\r\n\t}\r\n}\r\n\r\nDisasmBranchGuide.propTypes = {\r\n\tguide: PropTypes.shape({\r\n\t\tdirection: PropTypes.oneOf(['up', 'down']).isRequired,\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tlane: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\toffsets: PropTypes.object.isRequired,\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tselected: PropTypes.bool,\r\n};\r\n\r\nexport default DisasmBranchGuide;\r\n","function isSubsetBounds(bounds, parentBounds) {\r\n\tif (bounds.top < parentBounds.top || bounds.left < parentBounds.left) {\r\n\t\treturn false;\r\n\t}\r\n\tif (bounds.bottom > parentBounds.bottom || bounds.right > parentBounds.right) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isInView(node) {\r\n\tconst windowBounds = { top: 0, left: 0, bottom: window.innerHeight, right: window.innerWidth };\r\n\tconst rect = node.getBoundingClientRect();\r\n\tif (!isSubsetBounds(rect, windowBounds)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tlet parentNode = node;\r\n\twhile ((parentNode = parentNode.parentNode) !== null) {\r\n\t\tif (parentNode instanceof HTMLElement) {\r\n\t\t\tconst style = window.getComputedStyle(parentNode);\r\n\t\t\tconst overflows = style.overflow + style.overflowX + style.overflowY;\r\n\t\t\tif (style.position === 'static' && overflows.indexOf('auto') === -1 && overflows.indexOf('scroll') === -1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isSubsetBounds(rect, parentNode.getBoundingClientRect())) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nexport function ensureInView(node, options) {\r\n\tif (!isInView(node)) {\r\n\t\tnode.scrollIntoView(options);\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nlet contextMenuStatus = false;\r\n\r\nwindow.addEventListener('REACT_CONTEXTMENU_SHOW', (ev) => {\r\n\tcontextMenuStatus = true;\r\n});\r\nwindow.addEventListener('REACT_CONTEXTMENU_HIDE', (ev) => {\r\n\tcontextMenuStatus = false;\r\n});\r\n\r\nexport function hasContextMenu() {\r\n\treturn contextMenuStatus;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nexport default function BreakpointIcon(props) {\r\n\treturn (\r\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" className={props.className} viewBox=\"0 0 1536 1536\" width=\"12\" height=\"12\">\r\n\t\t\t<path d=\"M768,0 q209,0 385.5,103 t279.5,279.5 t103,385.5 t-103,385.5 t-279.5,279.5 t-385.5,103 t-385.5,-103 t-279.5,-279.5 t-103,-385.5 t103,-385.5 t279.5,-279.5 t385.5,-103 zm128,1247 v-190 q0,-14 -9,-23.5 t-22,-9.5 h-192 q-13,0 -23,10 t-10,23 v190 q0,13 10,23 t23,10 h192 q13,0 22,-9.5 t9,-23.5 zm-2,-344 l18,-621 q0,-12 -10,-18 q-10,-8 -24,-8 h-220 q-14,0 -24,8 q-10,6 -10,18 l17,621 q0,10 10,17.5 t24,7.5 h185 q14,0 23.5,-7.5 t10.5,-17.5 z\" />\r\n\t\t</svg>\r\n\t);\r\n}\r\n\r\nBreakpointIcon.propTypes = {\r\n\tclassName: PropTypes.string.isRequired,\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView } from '../../utils/dom';\r\nimport classNames from 'clsx';\r\nimport BreakpointIcon from './BreakpointIcon';\r\n\r\nclass DisasmLine extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { line, selected, focused, cursor } = this.props;\r\n\r\n\t\tconst className = classNames({\r\n\t\t\t'DisasmLine': true,\r\n\t\t\t'DisasmLine--selected': selected && !focused,\r\n\t\t\t'DisasmLine--focused': focused,\r\n\t\t\t'DisasmLine--cursor': cursor,\r\n\t\t\t'DisasmLine--breakpoint': line.breakpoint && line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--disabled-breakpoint': line.breakpoint && !line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--current': line.isCurrentPC,\r\n\t\t});\r\n\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { line, node: this.ref.current.parentNode };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" collect={mapData} attributes={attributes} holdToDisplay={-1}>\r\n\t\t\t\t<div className={className} style={{ backgroundColor: line.backgroundColor }} ref={this.ref} data-address={line.address}>\r\n\t\t\t\t\t<BreakpointIcon className=\"DisasmLine__breakpoint-icon\" />\r\n\t\t\t\t\t{this.renderAddress(line)}\r\n\t\t\t\t\t<code className=\"DisasmLine__opcode\">{this.highlight(line.name, '', line.params)} </code>\r\n\t\t\t\t\t<code className=\"DisasmLine__params\">{this.highlightParams(line.params, line.name, '')}{this.renderConditional(line)}</code>\r\n\t\t\t\t</div>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\trenderAddress(line) {\r\n\t\tconst { symbol, address, encoding } = line;\r\n\t\tconst addressHex = toString08X(address);\r\n\r\n\t\tif (this.props.displaySymbols) {\r\n\t\t\tif (symbol !== null) {\r\n\t\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--symbol\">{this.highlight(symbol + ':')}</code>;\r\n\t\t\t}\r\n\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--nosymbol\">{this.highlight(addressHex)}</code>;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<code className=\"DisasmLine__address DisasmLine__address--hexonly\">\r\n\t\t\t\t{this.highlight(addressHex)} {toString08X(encoding)}\r\n\t\t\t</code>\r\n\t\t);\r\n\t}\r\n\r\n\trenderConditional(line) {\r\n\t\tif (line.isCurrentPC && line.conditionMet !== null) {\r\n\t\t\treturn line.conditionMet ? ' ; true' : ' ; false';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\thighlight(text, before = '', after = '') {\r\n\t\tconst { highlight } = this.props;\r\n\t\tif (highlight !== null) {\r\n\t\t\tconst fullText = (before ? before + ' ' : '') + text + ' ' + after;\r\n\t\t\tlet pos = fullText.toLowerCase().indexOf(highlight);\r\n\t\t\tlet matchLength = highlight.length;\r\n\t\t\tif (pos !== -1) {\r\n\t\t\t\tconst beforeLength = before ? before.length + 1 : 0;\r\n\t\t\t\tif (pos < beforeLength) {\r\n\t\t\t\t\tmatchLength -= beforeLength - pos;\r\n\t\t\t\t\tpos = matchLength > 0 ? 0 : -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos -= beforeLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (pos >= 0 && pos < text.length) {\r\n\t\t\t\tconst className = classNames({\r\n\t\t\t\t\t'DisasmLine__highlight': true,\r\n\t\t\t\t\t'DisasmLine__highlight--end': pos + matchLength > text.length + 1,\r\n\t\t\t\t});\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t{text.substr(0, pos)}\r\n\t\t\t\t\t\t<span className={className}>{text.substr(pos, matchLength)}</span>\r\n\t\t\t\t\t\t{text.substr(pos + matchLength)}\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\thighlightParams(text, before = '', after = '') {\r\n\t\tconst { highlight, highlightParams } = this.props;\r\n\t\tif (highlight === null) {\r\n\t\t\tconst params = text.split(/([,()])/);\r\n\t\t\tconst toHighlight = highlightParams || [];\r\n\t\t\treturn params.map((param, key) => {\r\n\t\t\t\tlet className = 'DisasmLine__param';\r\n\t\t\t\tif (toHighlight.includes(param)) {\r\n\t\t\t\t\tclassName += ' DisasmLine__param--highlighted';\r\n\t\t\t\t}\r\n\t\t\t\treturn <span className={className} key={key}>{param}</span>;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.highlight(text, before, after);\r\n\t}\r\n\r\n\tonDoubleClick(ev, data) {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tensureInView(needsScroll) {\r\n\t\tconst triggerNode = this.ref.current.parentNode;\r\n\t\tif (needsScroll !== false) {\r\n\t\t\tensureInView(triggerNode, { block: needsScroll });\r\n\t\t}\r\n\t\ttriggerNode.focus();\r\n\t}\r\n\r\n\tstatic addressBoundingTop(parentNode, address) {\r\n\t\tconst lineNode = parentNode.querySelector('.DisasmLine[data-address=\"' + address + '\"]');\r\n\t\tif (lineNode) {\r\n\t\t\tconst triggerNode = lineNode.parentNode;\r\n\t\t\treturn triggerNode.getBoundingClientRect().top;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasmLine.propTypes = {\r\n\tline: PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tselected: PropTypes.bool,\r\n\tfocused: PropTypes.bool,\r\n\tcursor: PropTypes.bool,\r\n\tdisplaySymbols: PropTypes.bool,\r\n\thighlight: PropTypes.string,\r\n\thighlightParams: PropTypes.arrayOf(PropTypes.string),\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmLine;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DisasmBranchGuide from './DisasmBranchGuide';\r\nimport DisasmLine from './DisasmLine';\r\nimport { hasContextMenu } from '../../utils/dom';\r\nimport { listenCopy, forgetCopy } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\nimport { Timeout } from '../../utils/timeouts';\r\n\r\nclass DisasmList extends PureComponent {\r\n\tstate = {\r\n\t\tmouseDown: false,\r\n\t\tfocused: false,\r\n\t\tlineOffsets: {},\r\n\t\tpendingLineParams: [],\r\n\t\tselectedLineParams: [],\r\n\t\tprevLines: null,\r\n\t\tprevSelectionTop: null,\r\n\t\tprevSelectionBottom: null,\r\n\t};\r\n\tfocusTimeout;\r\n\tparamsTimeout;\r\n\tref;\r\n\tcursorRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.cursorRef = React.createRef();\r\n\t\tthis.focusTimeout = new Timeout(() => null, 20);\r\n\t\tthis.paramsTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ selectedLineParams: this.state.pendingLineParams });\r\n\t\t}, 20);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonMouseDownCapture: ev => this.onMouseDown(ev),\r\n\t\t\tonMouseUpCapture: this.state.mouseDown ? (ev => this.onMouseUp(ev)) : undefined,\r\n\t\t\tonMouseMove: this.state.mouseDown ? (ev => this.onMouseMove(ev)) : undefined,\r\n\t\t\tonKeyDown: ev => this.onKeyDown(ev),\r\n\t\t\tonBlur: ev => this.onFocusChange(ev, false),\r\n\t\t\tonFocus: ev => this.onFocusChange(ev, true),\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm__list\" ref={this.ref} {...events}>\r\n\t\t\t\t{this.props.lines.map((line) => this.renderLine(line))}\r\n\t\t\t\t{this.props.branchGuides.map((guide) => this.renderBranchGuide(guide))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLine(line) {\r\n\t\tconst { displaySymbols, cursor } = this.props;\r\n\t\tlet props = {\r\n\t\t\tdisplaySymbols,\r\n\t\t\tline,\r\n\t\t\tselected: this.isLineSelected(line),\r\n\t\t\tcursor: line.address === cursor,\r\n\t\t\tonDoubleClick: this.props.onDoubleClick,\r\n\t\t\tref: line.address === cursor ? this.cursorRef : undefined,\r\n\t\t\t// Avoid re-rendering lines unnecessarily.\r\n\t\t\thighlight: this.shouldHighlight(line, this.props.highlightText) ? this.props.highlightText : null,\r\n\t\t\thighlightParams: this.shouldHighlightParams(line) ? this.state.selectedLineParams : null,\r\n\t\t};\r\n\t\tprops.focused = props.selected && this.state.focused;\r\n\r\n\t\treturn <DisasmLine key={line.address} contextmenu=\"disasm\" {...props} />;\r\n\t}\r\n\r\n\trenderBranchGuide(guide) {\r\n\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\tconst { range, lineHeight, cursor } = this.props;\r\n\t\tconst props = {\r\n\t\t\tkey,\r\n\t\t\tguide,\r\n\t\t\toffsets: this.state.lineOffsets,\r\n\t\t\trange,\r\n\t\t\tlineHeight,\r\n\t\t\tselected: guide.top === cursor || guide.bottom === cursor,\r\n\t\t};\r\n\r\n\t\treturn <DisasmBranchGuide {...props} />;\r\n\t}\r\n\r\n\tshouldHighlight(line, match) {\r\n\t\tlet parts = [];\r\n\t\tparts.push(toString08X(line.address));\r\n\t\tif (line.symbol !== null) {\r\n\t\t\tparts.push(line.symbol + ':');\r\n\t\t}\r\n\t\tparts.push(line.name + ' ' + line.params);\r\n\r\n\t\treturn parts.some(part => part.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\tshouldHighlightParams(line, match) {\r\n\t\tif (this.isLineSelected(line)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.state.selectedLineParams.some(param => line.params.indexOf(param) !== -1);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\taddressBoundingTop(address) {\r\n\t\t// It seems like pointless complexity to use a ref for this.\r\n\t\treturn DisasmLine.addressBoundingTop(this.ref.current, address);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\tensureCursorInView(options) {\r\n\t\tif (this.cursorRef.current) {\r\n\t\t\tthis.cursorRef.current.ensureInView(options);\r\n\t\t}\r\n\t}\r\n\r\n\tisLineSelected(line) {\r\n\t\treturn DisasmList.isLineSelected(this.props, line);\r\n\t}\r\n\r\n\tstatic isLineSelected({ selectionTop, selectionBottom }, line) {\r\n\t\treturn line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t}\r\n\r\n\tstatic calcOffsets(lines, lineHeight) {\r\n\t\tlet pos = 0;\r\n\t\tlet offsets = {};\r\n\t\tlines.forEach((line) => {\r\n\t\t\toffsets[line.address] = pos;\r\n\t\t\tpos += lineHeight;\r\n\t\t});\r\n\t\treturn offsets;\r\n\t}\r\n\r\n\tstatic getSelectedLineParams({ lines, selectionTop, selectionBottom }) {\r\n\t\tconst selectedLines = lines.filter(DisasmList.isLineSelected.bind(null, { selectionTop, selectionBottom }));\r\n\r\n\t\tlet params = {};\r\n\t\tfor (let line of selectedLines) {\r\n\t\t\tfor (let param of line.params.split(/[,()]/)) {\r\n\t\t\t\tparams[param] = param;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete params[''];\r\n\r\n\t\treturn Object.values(params);\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst linesChanged = nextProps.lines !== prevState.prevLines;\r\n\t\tconst selectionChanged = nextProps.selectionTop !== prevState.prevSelectionTop || nextProps.selectionBottom !== prevState.prevSelectionBottom;\r\n\r\n\t\tlet offsetsUpdate = null;\r\n\t\tif (linesChanged) {\r\n\t\t\tconst lineOffsets = DisasmList.calcOffsets(nextProps.lines, nextProps.lineHeight);\r\n\t\t\toffsetsUpdate = { lineOffsets, prevLines: nextProps.lines };\r\n\t\t}\r\n\r\n\t\tlet selectedUpdate = null;\r\n\t\tif (linesChanged || selectionChanged) {\r\n\t\t\tselectedUpdate = {\r\n\t\t\t\tpendingLineParams: DisasmList.getSelectedLineParams(nextProps),\r\n\t\t\t\tprevSelectionTop: nextProps.selectionTop,\r\n\t\t\t\tprevSelectionBottom: nextProps.selectionBottom,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (offsetsUpdate !== null || selectedUpdate !== null) {\r\n\t\t\treturn { ...offsetsUpdate, ...selectedUpdate };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tlistenCopy('.Disasm__list', this.onCopy);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tforgetCopy('.Disasm__list', this.onCopy);\r\n\t\tthis.paramsTimeout.cancel();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.state.pendingLineParams !== prevState.pendingLineParams) {\r\n\t\t\t// Apply the line params soon after selection change - not immediately for quicker scrolling.\r\n\t\t\tthis.paramsTimeout.start();\r\n\t\t}\r\n\t}\r\n\r\n\tonCopy = (ev) => {\r\n\t\treturn this.props.getSelectedDisasm();\r\n\t}\r\n\r\n\tonFocusChange(ev, focused) {\r\n\t\tconst update = () => {\r\n\t\t\tif (focused !== this.state.focused) {\r\n\t\t\t\tthis.setState({ focused });\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.focusTimeout.cancel();\r\n\r\n\t\tif (!focused) {\r\n\t\t\t// We use an arbitrary short delay because a click will temporarily blur.\r\n\t\t\tthis.focusTimeout.reset(update);\r\n\t\t\tthis.focusTimeout.start();\r\n\t\t} else {\r\n\t\t\tupdate();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseDown(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\t// Don't change selection if right clicking within the selection.\r\n\t\tif (ev.button !== 2 || !this.isLineSelected(line)) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t} else {\r\n\t\t\t// But do change the cursor.\r\n\t\t\tthis.props.updateCursor(line.address);\r\n\t\t}\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.setState({ mouseDown: true });\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseUp(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t\tthis.setState({ mouseDown: false });\r\n\t}\r\n\r\n\tonMouseMove(ev) {\r\n\t\tif (ev.buttons === 0) {\r\n\t\t\tthis.setState({ mouseDown: false });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modifiers = (ev.ctrlKey ? 'c' : '') + (ev.metaKey ? 'm' : '') + (ev.altKey ? 'a' : '') + (ev.shiftKey ? 's' : '');\r\n\r\n\t\tif (['ArrowUp', 'ArrowDown', 'PageUp', 'PageDown'].includes(ev.key)) {\r\n\t\t\tlet dist = 1;\r\n\t\t\tif (ev.key === 'PageUp' || ev.key === 'PageDown') {\r\n\t\t\t\tdist = this.props.visibleLines;\r\n\t\t\t}\r\n\t\t\tif (ev.key === 'ArrowUp' || ev.key === 'PageUp') {\r\n\t\t\t\tdist = -dist;\r\n\t\t\t}\r\n\r\n\t\t\tif (modifiers === '' || modifiers === 's') {\r\n\t\t\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\t\t\tconst newIndex = Math.min(this.props.lines.length - 1, Math.max(0, lineIndex + dist));\r\n\t\t\t\tif (lineIndex !== newIndex) {\r\n\t\t\t\t\tthis.applySelection(ev, this.props.lines[newIndex]);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t} else if (ev.ctrlKey) {\r\n\t\t\t\tthis.props.applyScroll(dist);\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') && modifiers === '') {\r\n\t\t\tthis.props.followBranch(ev.key === 'ArrowRight', this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'Tab' && modifiers === '') {\r\n\t\t\tthis.props.updateDisplaySymbols(!this.props.displaySymbols);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'a' && modifiers === 'c') {\r\n\t\t\tthis.props.assembleInstruction(this.findCursorLine(), '');\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === ' ' || ev.key === 'Spacebar') && modifiers === '') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'd' && modifiers === 'c') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine(), true);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 's' || ev.key === 'f') && modifiers === 'c') {\r\n\t\t\tthis.props.searchPrompt();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'F3') && modifiers === '') {\r\n\t\t\tthis.props.searchNext();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'g' && modifiers === 'c') {\r\n\t\t\tthis.props.promptGoto();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'e' && modifiers === 'c') {\r\n\t\t\tthis.props.editBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tapplySelection(ev, line) {\r\n\t\tlet { selectionTop, selectionBottom } = this.props;\r\n\t\tif (ev.shiftKey) {\r\n\t\t\tselectionTop = Math.min(selectionTop, line.address);\r\n\t\t\tselectionBottom = Math.max(selectionBottom, line.address);\r\n\t\t} else {\r\n\t\t\tselectionTop = line.address;\r\n\t\t\tselectionBottom = line.address;\r\n\t\t}\r\n\r\n\t\tif (selectionTop !== this.props.selectionTop || selectionBottom !== this.props.selectionBottom) {\r\n\t\t\tthis.props.updateSelection({\r\n\t\t\t\tselectionTop,\r\n\t\t\t\tselectionBottom,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.props.updateCursor(line.address);\r\n\t}\r\n\r\n\tmouseEventToLine(ev) {\r\n\t\t// Account for page and list scrolling.\r\n\t\tconst y = ev.pageY - this.ref.current.getBoundingClientRect().top - window.pageYOffset;\r\n\t\tconst index = Math.floor(y / this.props.lineHeight);\r\n\t\treturn this.props.lines[index];\r\n\t}\r\n\r\n\tfindCursorLineIndex() {\r\n\t\tconst { cursor, lines, selectionTop } = this.props;\r\n\t\tconst addr = cursor ? cursor : selectionTop;\r\n\t\tfor (let i = 0; i < lines.length; ++i) {\r\n\t\t\tif (lines[i].address === addr) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tfindCursorLine() {\r\n\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\treturn this.props.lines[lineIndex];\r\n\t}\r\n}\r\n\r\nDisasmList.propTypes = {\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tvisibleLines: PropTypes.number.isRequired,\r\n\tdisplaySymbols: PropTypes.bool.isRequired,\r\n\tcursor: PropTypes.number,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\thighlightText: PropTypes.string,\r\n\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tupdateCursor: PropTypes.func.isRequired,\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tupdateDisplaySymbols: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n\tapplyScroll: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n\tsearchPrompt: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n\teditBreakpoint: PropTypes.func.isRequired,\r\n\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlines: PropTypes.arrayOf(PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t})).isRequired,\r\n\tbranchGuides: PropTypes.arrayOf(PropTypes.shape({\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tdirection: PropTypes.string.isRequired,\r\n\t})).isRequired,\r\n};\r\n\r\nexport default DisasmList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\nimport './DisasmSearch.css';\r\n\r\nclass DisasmSearch extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst value = this.props.searchString || '';\r\n\t\tconst classes = classNames('DisasmSearch__field', { 'DisasmSearch__field--progress': this.props.inProgress });\r\n\r\n\t\treturn (\r\n\t\t\t/* eslint no-script-url: \"off\" */\r\n\t\t\t<form action=\"#\" className=\"DisasmSearch\" hidden={this.props.searchString === null} onSubmit={this.handleNext}>\r\n\t\t\t\t<div className={classes}>\r\n\t\t\t\t\t<input type=\"search\" value={value} placeholder=\"Find...\" onChange={this.handleChange} onKeyDown={this.handleKeyDown} ref={this.ref} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<button type=\"submit\">\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Search / Next</title>\r\n\t\t\t\t\t\t<path d=\"M10,50 l80,0 l-35,-40 m35,40 l-35,40\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button type=\"button\" onClick={this.handleCancel}>\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 180 180\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Cancel</title>\r\n\t\t\t\t\t\t<path d=\"M30,30 l120,120 m-120,0 l120,-120\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevProps.searchString === null && this.props.searchString !== null) {\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.props.updateSearchString(ev.target.value);\r\n\t}\r\n\r\n\thandleNext = (ev) => {\r\n\t\tthis.props.searchNext();\r\n\t\tthis.focus();\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandleCancel = (ev) => {\r\n\t\tthis.props.updateSearchString(null);\r\n\t}\r\n\r\n\thandleKeyDown = (ev) => {\r\n\t\tif (ev.key === 'Escape') {\r\n\t\t\tthis.handleCancel();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tfocus() {\r\n\t\tthis.ref.current.focus();\r\n\t}\r\n}\r\n\r\nDisasmSearch.propTypes = {\r\n\tsearchString: PropTypes.string,\r\n\tinProgress: PropTypes.bool.isRequired,\r\n\tupdateSearchString: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmSearch;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { toString02X, toString04X, toString08X } from '../../utils/format';\r\nimport './StatusBar.css';\r\n\r\nclass StatusBar extends PureComponent {\r\n\trender() {\r\n\t\tconst { line } = this.props;\r\n\t\tif (!line) {\r\n\t\t\treturn <div className=\"StatusBar\"></div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"StatusBar\">\r\n\t\t\t\t<div className=\"StatusBar__left\">{this.renderLeftStatus(line)}</div>\r\n\t\t\t\t<div className=\"StatusBar__right\">{line.function || line.symbol || ''}</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLeftStatus(line) {\r\n\t\tif (line.type === 'opcode' || line.type === 'macro') {\r\n\t\t\tif (line.dataAccess) {\r\n\t\t\t\treturn this.renderDataAccess(line.dataAccess);\r\n\t\t\t} else if (line.branch) {\r\n\t\t\t\treturn this.renderBranch(line.branch);\r\n\t\t\t} else if (line.relevantData && typeof line.relevantData.stringValue === 'string') {\r\n\t\t\t\treturn this.renderString(line.relevantData);\r\n\t\t\t}\r\n\t\t} else if (line.type === 'data') {\r\n\t\t\treturn this.renderDataSymbol(line.dataSymbol, line.address);\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\trenderDataAccess(dataAccess) {\r\n\t\tif (dataAccess.uintValue === null) {\r\n\t\t\treturn 'Invalid address ' + toString08X(dataAccess.address);\r\n\t\t}\r\n\r\n\t\tlet status = '[' + toString08X(dataAccess.address) + '] = ';\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += dataAccess.valueSymbol + ' (';\r\n\t\t}\r\n\t\tif (dataAccess.size === 1) {\r\n\t\t\tstatus += toString02X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size === 2) {\r\n\t\t\tstatus += toString04X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size >= 4) {\r\n\t\t\t// TODO: Show vectors better.\r\n\t\t\tstatus += toString08X(dataAccess.uintValue);\r\n\t\t}\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += ')';\r\n\t\t}\r\n\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderBranch(branch) {\r\n\t\tlet status = branch.targetAddress ? toString08X(branch.targetAddress) : '';\r\n\t\tif (branch.symbol) {\r\n\t\t\tstatus += ' = ' + branch.symbol;\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderString(data) {\r\n\t\treturn '[' + toString08X(data.address) + '] = ' + JSON.stringify(data.stringValue);\r\n\t}\r\n\r\n\trenderDataSymbol(dataSymbol, address) {\r\n\t\tlet status = toString08X(dataSymbol.start);\r\n\t\tif (dataSymbol.label) {\r\n\t\t\tstatus += ' (' + dataSymbol.label + ')';\r\n\t\t}\r\n\t\tif (address !== dataSymbol.start) {\r\n\t\t\tstatus += ' + ' + toString08X(dataSymbol.start - address);\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n}\r\n\r\nStatusBar.propTypes = {\r\n\tline: PropTypes.object,\r\n};\r\n\r\nexport default StatusBar;\r\n","class Listeners {\r\n\tconstructor() {\r\n\t\tthis.changeCallbacks_ = [];\r\n\t\tthis.ppsspp_ = null;\r\n\t\tthis.connected_ = false;\r\n\t}\r\n\r\n\tinit(ppsspp) {\r\n\t\tthis.ppsspp_ = ppsspp;\r\n\t}\r\n\r\n\t// Change the active connection.\r\n\tchange(connected) {\r\n\t\tthis.connected_ = connected;\r\n\t\tfor (let callback of this.changeCallbacks_) {\r\n\t\t\tcallback(connected);\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange(callback) {\r\n\t\tthis.changeCallbacks_.push(callback);\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst index = this.changeCallbacks_.indexOf(callback);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tthis.changeCallbacks_.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tonConnection(callback) {\r\n\t\tconst changeCallback = (connected) => {\r\n\t\t\tif (connected) {\r\n\t\t\t\tcallback(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (this.connected_) {\r\n\t\t\tcallback(true);\r\n\t\t}\r\n\r\n\t\treturn this.onConnectionChange(changeCallback);\r\n\t}\r\n\r\n\t// Listen for events (and re-register as necessary.)\r\n\tlisten(handlers) {\r\n\t\tlet result = [];\r\n\t\tfor (let name in handlers) {\r\n\t\t\tif (handlers.hasOwnProperty(name)) {\r\n\t\t\t\tlet listener;\r\n\t\t\t\tif (name === 'connection') {\r\n\t\t\t\t\tlistener = this.onConnection(handlers[name]);\r\n\t\t\t\t} else if (name === 'connection.change') {\r\n\t\t\t\t\tlistener = this.onConnectionChange(handlers[name]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlistener = this.ppsspp_.listen(name, handlers[name]);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(listener);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tforget(listeners) {\r\n\t\tfor (let listener of listeners) {\r\n\t\t\tlistener.remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst listeners = new Listeners();\r\nexport default listeners;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport DisasmContextMenu from './DisasmContextMenu';\r\nimport DisasmList from './DisasmList';\r\nimport DisasmSearch from './DisasmSearch';\r\nimport StatusBar from './StatusBar';\r\nimport { toString08X } from '../../utils/format';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './Disasm.css';\r\n\r\nconst MIN_BUFFER = 100;\r\nconst MAX_BUFFER = 500;\r\n\r\nclass Disasm extends PureComponent {\r\n\tstate = {\r\n\t\tlines: [],\r\n\t\tbranchGuides: [],\r\n\t\trange: { start: 0, end: 0 },\r\n\t\tlineHeight: 0,\r\n\t\tvisibleLines: 0,\r\n\t\tdisplaySymbols: true,\r\n\t\twantDisplaySymbols: true,\r\n\t\tcursor: null,\r\n\t\tsearchString: null,\r\n\t\tsearchInProgress: false,\r\n\t\thighlightText: null,\r\n\t\teditingBreakpoint: null,\r\n\t};\r\n\tjumpStack = [];\r\n\tneedsScroll = false;\r\n\tneedsOffsetFix = false;\r\n\tupdatesCancel = false;\r\n\tupdatesSequence = Promise.resolve(null);\r\n\tlastSearch = null;\r\n\tref;\r\n\tlistRef;\r\n\tsearchRef;\r\n\tlisteners_;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.listRef = React.createRef();\r\n\t\tthis.searchRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonScroll: ev => this.onScroll(ev),\r\n\t\t\tonDragStart: ev => ev.preventDefault(),\r\n\t\t};\r\n\r\n\t\tif (!this.props.started) {\r\n\t\t\treturn this.renderNotStarted();\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<div ref={this.ref} className=\"Disasm\" {...events}>\r\n\t\t\t\t\t<DisasmList ref={this.listRef} {...this.state}\r\n\t\t\t\t\t\tonDoubleClick={this.onDoubleClick}\r\n\t\t\t\t\t\tupdateSelection={this.props.updateSelection}\r\n\t\t\t\t\t\tpromptGoto={this.props.promptGoto}\r\n\t\t\t\t\t\tupdateCursor={this.updateCursor}\r\n\t\t\t\t\t\tupdateDisplaySymbols={this.updateDisplaySymbols}\r\n\t\t\t\t\t\tselectionTop={this.props.selectionTop}\r\n\t\t\t\t\t\tselectionBottom={this.props.selectionBottom}\r\n\t\t\t\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\t\t\t\tfollowBranch={this.followBranch}\r\n\t\t\t\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\t\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t\t\t\t\teditBreakpoint={this.editBreakpoint}\r\n\t\t\t\t\t\tapplyScroll={this.applyScroll}\r\n\t\t\t\t\t\tsearchPrompt={this.searchPrompt}\r\n\t\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<StatusBar line={this.state.lines.find(l => l.address === this.state.cursor)} />\r\n\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t\t<DisasmSearch ref={this.searchRef}\r\n\t\t\t\t\tsearchString={this.state.searchString}\r\n\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\tupdateSearchString={this.updateSearchString}\r\n\t\t\t\t\tinProgress={this.state.searchInProgress}\r\n\t\t\t\t/>\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\t\t\tisOpen={this.state.editingBreakpoint !== null}\r\n\t\t\t\t\tonClose={this.closeEditBreakpoint}\r\n\t\t\t\t\tbreakpoint={this.state.editingBreakpoint}\r\n\t\t\t\t/>\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\trenderNotStarted() {\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm--not-started\">\r\n\t\t\t\tWaiting for a game to start...\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\treturn <DisasmContextMenu\r\n\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\tlog={this.props.log}\r\n\t\t\tstepping={this.props.stepping}\r\n\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\tgetSelectedLines={this.getSelectedLines}\r\n\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\tfollowBranch={this.followBranch}\r\n\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t/>;\r\n\t}\r\n\r\n\tupdateCursor = (cursor) => {\r\n\t\tif (this.state.cursor !== cursor) {\r\n\t\t\tthis.needsScroll = 'nearest';\r\n\t\t\tthis.setState({ cursor });\r\n\r\n\t\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet { start, end } = this.state.range;\r\n\t\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\r\n\t\t\t\t// This is here for keyboard scrolling, mainly.\r\n\t\t\t\tif (cursor - minBuffer * 4 < start) {\r\n\t\t\t\t\tstart = cursor - minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor - maxBuffer * 4 > start) {\r\n\t\t\t\t\tstart = cursor - (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (cursor + minBuffer * 4 > end) {\r\n\t\t\t\t\tend = cursor + minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor + maxBuffer * 4 < end) {\r\n\t\t\t\t\tend = cursor + (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\t\treturn this.updateDisasmNow('nearest', { address: start, end });\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelectedLines = () => {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst isSelected = line => line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t\treturn this.state.lines.filter(isSelected);\r\n\t}\r\n\r\n\tgetSelectedDisasm = () => {\r\n\t\tconst lines = this.getSelectedLines();\r\n\r\n\t\t// Gather all branch targets without labels.\r\n\t\tlet branchAddresses = {};\r\n\t\tconst unlabeledBranches = lines.map(l => l.branch).filter(b => b && !b.symbol && b.targetAddress);\r\n\t\tfor (const b of unlabeledBranches) {\r\n\t\t\tbranchAddresses[b.targetAddress] = 'pos_' + toString08X(b.targetAddress);\r\n\t\t}\r\n\r\n\t\tlet result = '';\r\n\t\tlet firstLine = true;\r\n\t\tfor (const l of lines) {\r\n\t\t\tconst label = l.symbol || branchAddresses[l.address];\r\n\t\t\tif (label) {\r\n\t\t\t\tif (!firstLine) {\r\n\t\t\t\t\tresult += '\\n';\r\n\t\t\t\t}\r\n\t\t\t\tresult += label + ':\\n\\n';\r\n\t\t\t}\r\n\r\n\t\t\tresult += '\\t' + l.name + ' ';\r\n\t\t\tif (l.branch && l.branch.targetAddress && !l.branch.symbol) {\r\n\t\t\t\t// Use the generated label.\r\n\t\t\t\tresult += l.params.replace(/0x[0-9A-f]+/, branchAddresses[l.branch.targetAddress]);\r\n\t\t\t} else {\r\n\t\t\t\tresult += l.params;\r\n\t\t\t}\r\n\t\t\tresult += '\\n';\r\n\r\n\t\t\tfirstLine = false;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tupdateDisplaySymbols = (flag) => {\r\n\t\tthis.setState({ wantDisplaySymbols: flag });\r\n\t}\r\n\r\n\tfollowBranch = (direction, line) => {\r\n\t\tif (direction) {\r\n\t\t\tlet target = line.branch && line.branch.targetAddress;\r\n\t\t\tif (target === null) {\r\n\t\t\t\ttarget = line.relevantData && line.relevantData.address;\r\n\t\t\t}\r\n\t\t\tif (target !== null) {\r\n\t\t\t\tthis.jumpStack.push(this.state.cursor);\r\n\t\t\t\tthis.gotoAddress(target);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.jumpStack.length !== 0) {\r\n\t\t\t\tthis.gotoAddress(this.jumpStack.pop());\r\n\t\t\t} else {\r\n\t\t\t\tthis.gotoAddress(this.props.pc);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tassembleInstruction = (line, startCode) => {\r\n\t\tconst { address } = line;\r\n\t\tconst code = prompt('Assemble instruction', startCode);\r\n\t\tif (!code) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst writeInstruction = () => {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'memory.assemble',\r\n\t\t\t\taddress: address,\r\n\t\t\t\tcode,\r\n\t\t\t}).then(() => {\r\n\t\t\t\tif (address === this.state.cursor) {\r\n\t\t\t\t\t// Okay, move one down so we can fire 'em off.\r\n\t\t\t\t\tconst lineIndex = this.state.lines.indexOf(line);\r\n\t\t\t\t\tif (lineIndex < this.state.lines.length - 1) {\r\n\t\t\t\t\t\tconst nextAddress = this.state.lines[lineIndex + 1].address;\r\n\t\t\t\t\t\tthis.gotoAddress(nextAddress, 'nearest');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Now, whether we moved or not, also update disasm.\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Check if this is actually a register assignment.\r\n\t\tconst assignment = code.split(/\\s*=\\s*(.+)$/, 2);\r\n\t\tif (assignment.length >= 2) {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\texpression: assignment[1],\r\n\t\t\t}).then((result) => {\r\n\t\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\t\tevent: 'cpu.setReg',\r\n\t\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\t\tname: assignment[0],\r\n\t\t\t\t\tvalue: result.uintValue,\r\n\t\t\t\t});\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tthis.props.log('Updated ' + assignment[0] + ' to ' + toString08X(uintValue));\r\n\t\t\t}, writeInstruction);\r\n\t\t} else {\r\n\t\t\treturn writeInstruction();\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleBreakpoint = (line, keep) => {\r\n\t\tif (line.breakpoint === null) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.add',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (!line.breakpoint.enabled) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.breakpoint.address || line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (keep) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.breakpoint.address || line.address,\r\n\t\t\t\tenabled: false,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (line.breakpoint.condition !== null) {\r\n\t\t\t\tif (!window.confirm('This breakpoint has has a condition.\\n\\nAre you sure you want to remove it?')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.remove',\r\n\t\t\t\taddress: line.breakpoint.address || line.address,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\teditBreakpoint = (line) => {\r\n\t\t// In case it's actually in the middle of a macro.\r\n\t\tconst breakpointAddress = line.breakpoint.address || line.address;\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.breakpoint.list',\r\n\t\t\taddress: breakpointAddress,\r\n\t\t\tenabled: true,\r\n\t\t}).then(({ breakpoints }) => {\r\n\t\t\tconst bp = breakpoints.find(bp => bp.address === breakpointAddress);\r\n\t\t\tif (bp) {\r\n\t\t\t\tconst editingBreakpoint = { ...bp, type: 'execute' };\r\n\t\t\t\tthis.setState({ editingBreakpoint });\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcloseEditBreakpoint = () => {\r\n\t\tthis.setState({ editingBreakpoint: null });\r\n\t}\r\n\r\n\tgotoAddress = (addr, snap = 'center') => {\r\n\t\tthis.needsScroll = snap;\r\n\t\tthis.props.updateSelection({\r\n\t\t\tselectionTop: addr,\r\n\t\t\tselectionBottom: addr,\r\n\t\t});\r\n\t}\r\n\r\n\tsearchDisasm = (cont) => {\r\n\t\tconst continueLast = cont && this.lastSearch !== null;\r\n\t\tconst { cursor, searchString } = this.state;\r\n\t\tif (!continueLast && !searchString) {\r\n\t\t\t// Prompt for a term so we can even do this.\r\n\t\t\tthis.searchPrompt();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.state.searchInProgress) {\r\n\t\t\tif (continueLast) {\r\n\t\t\t\t// Already doing that, silly.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.searchCancel();\r\n\t\t}\r\n\r\n\t\tif (!continueLast) {\r\n\t\t\tthis.lastSearch = {\r\n\t\t\t\tmatch: searchString,\r\n\t\t\t\tend: cursor,\r\n\t\t\t\tlast: null,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Set a new object so we can detect cancel uniquely.\r\n\t\tconst cancelState = { cancel: false };\r\n\t\tthis.lastSearch.cancelState = cancelState;\r\n\t\tthis.setState({ searchInProgress: true });\r\n\r\n\t\tconst { match, end, last } = this.lastSearch;\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'memory.searchDisasm',\r\n\t\t\taddress: cursor === last ? cursor + 4 : cursor,\r\n\t\t\tend,\r\n\t\t\tmatch,\r\n\t\t}).then(({ address }) => {\r\n\t\t\tif (cancelState.cancel) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.lastSearch) {\r\n\t\t\t\tthis.lastSearch.last = address;\r\n\t\t\t}\r\n\r\n\t\t\tif (address !== null) {\r\n\t\t\t\tthis.gotoAddress(address);\r\n\t\t\t} else if (cursor !== end) {\r\n\t\t\t\twindow.alert('Reached the starting point of the search');\r\n\t\t\t\tthis.gotoAddress(end);\r\n\t\t\t} else {\r\n\t\t\t\twindow.alert('The specified text was not found:\\n\\n' + match);\r\n\t\t\t}\r\n\t\t}).finally(() => {\r\n\t\t\tif (!cancelState.cancel) {\r\n\t\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\t\tif (this.lastSearch) {\r\n\t\t\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSearchString = (match) => {\r\n\t\tconst highlightText = match ? match.toLowerCase() : null;\r\n\t\tthis.setState({ highlightText, searchString: match });\r\n\t\tif (this.lastSearch && this.lastSearch.match !== match) {\r\n\t\t\t// Clear the search start position when changing the search.\r\n\t\t\tthis.searchCancel();\r\n\t\t\tthis.lastSearch = null;\r\n\t\t}\r\n\r\n\t\tif (match === null) {\r\n\t\t\t// Return focus to list.\r\n\t\t\tif (this.listRef.current) {\r\n\t\t\t\tthis.listRef.current.ensureCursorInView(false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsearchPrompt = () => {\r\n\t\tthis.updateSearchString(this.state.searchString || (this.lastSearch ? this.lastSearch.match : ''));\r\n\t\tthis.searchRef.current.focus();\r\n\t}\r\n\r\n\tsearchNext = () => {\r\n\t\tthis.searchDisasm(true);\r\n\t}\r\n\r\n\tsearchCancel = () => {\r\n\t\tif (this.lastSearch && this.lastSearch.cancelState) {\r\n\t\t\tthis.lastSearch.cancelState.cancel = true;\r\n\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t}\r\n\t}\r\n\r\n\tgetSnapshotBeforeUpdate(prevProps, prevState) {\r\n\t\tif (this.needsOffsetFix && this.listRef.current && this.state.lines.length !== 0) {\r\n\t\t\tconst { lines } = this.state;\r\n\t\t\tconst centerAddress = lines[Math.floor(lines.length / 2)].address;\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(centerAddress);\r\n\t\t\tif (top) {\r\n\t\t\t\treturn { top, centerAddress };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => {\r\n\t\t\t\tif (this.props.started) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.stepping': () => {\r\n\t\t\t\tconst hasRange = this.state.range.start !== 0 || this.state.range.end !== 0;\r\n\t\t\t\tthis.updateDisasm(hasRange ? 'nearest' : 'center');\r\n\t\t\t},\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\t// Need to re-render if pc is changed.\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.add': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.update': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.remove': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.updatesCancel = false;\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.searchCancel();\r\n\t\tthis.updatesCancel = true;\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst { range, lineHeight } = this.state;\r\n\r\n\t\tlet disasmChange = null, updateDisasmRange = null;\r\n\t\tif (this.state.wantDisplaySymbols !== prevState.wantDisplaySymbols) {\r\n\t\t\t// Keep the existing range, just update.\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (selectionTop !== prevProps.selectionTop || selectionBottom !== prevProps.selectionBottom) {\r\n\t\t\tif (selectionTop < range.start || selectionBottom >= range.end) {\r\n\t\t\t\tdisasmChange = 'center';\r\n\t\t\t\tupdateDisasmRange = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!disasmChange && !prevProps.setInitialPC && this.props.setInitialPC) {\r\n\t\t\tdisasmChange = 'center';\r\n\t\t\tupdateDisasmRange = true;\r\n\t\t}\r\n\t\tif (disasmChange !== null && this.props.setInitialPC) {\r\n\t\t\tthis.updateDisasm(disasmChange, updateDisasmRange);\r\n\t\t}\r\n\r\n\t\tif (lineHeight === 0) {\r\n\t\t\tconst foundLine = document.querySelector('.DisasmLine');\r\n\t\t\tif (foundLine) {\r\n\t\t\t\t// Defer for other updates.\r\n\t\t\t\tsetTimeout(() => this.setState({ lineHeight: foundLine.getBoundingClientRect().height }), 0);\r\n\t\t\t}\r\n\t\t} else if (this.ref.current) {\r\n\t\t\tconst visibleLines = Math.floor(this.ref.current.clientHeight / lineHeight);\r\n\t\t\tif (visibleLines !== this.state.visibleLines) {\r\n\t\t\t\tthis.setState({ visibleLines });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.props.jumpMarker !== prevProps.jumpMarker) {\r\n\t\t\tthis.needsScroll = 'center';\r\n\t\t}\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.listRef.current) {\r\n\t\t\tconst list = this.listRef.current;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlist.ensureCursorInView(this.needsScroll);\r\n\t\t\t\tthis.needsScroll = false;\r\n\t\t\t}, 0);\r\n\t\t}\r\n\r\n\t\tif (snapshot && this.listRef.current) {\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(snapshot.centerAddress);\r\n\t\t\tthis.ref.current.scrollTop -= snapshot.top - top;\r\n\t\t\tthis.needsOffsetFix = false;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateDisasm(needsScroll, newRange) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\treturn this.updateDisasmNow(needsScroll, newRange);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateDisasmNow(needsScroll, newRange = null) {\r\n\t\tif (!this.props.setInitialPC) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst { range, visibleLines, wantDisplaySymbols: displaySymbols } = this.state;\r\n\t\tlet updateRange = newRange;\r\n\t\tif (newRange === true || (newRange === null && range.start === 0 && range.end === 0)) {\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, visibleLines);\r\n\t\t\tconst defaultBuffer = Math.floor(minBuffer * 1.5);\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: this.props.selectionTop - defaultBuffer * 4,\r\n\t\t\t\tcount: defaultBuffer * 2,\r\n\t\t\t};\r\n\t\t} else if (newRange === null) {\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: range.start,\r\n\t\t\t\tend: range.end,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(null).then(() => {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'memory.disasm',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\t...updateRange,\r\n\t\t\t\tdisplaySymbols,\r\n\t\t\t}).then((data) => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst { range, branchGuides, lines } = data;\r\n\t\t\t\tif (needsScroll) {\r\n\t\t\t\t\tthis.needsScroll = needsScroll;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.needsOffsetFix = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\trange,\r\n\t\t\t\t\tbranchGuides: this.cleanupBranchGuides(branchGuides),\r\n\t\t\t\t\tlines,\r\n\t\t\t\t\tdisplaySymbols,\r\n\t\t\t\t});\r\n\t\t\t}, (err) => {\r\n\t\t\t\tif (!this.updatesCancel) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\trange: { start: 0, end: 0 },\r\n\t\t\t\t\t\tbranchGuides: [],\r\n\t\t\t\t\t\tlines: [],\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tcleanupBranchGuides(branchGuides) {\r\n\t\t// TODO: Temporary (?) workaround for a bug with duplicate branch guides.\r\n\t\tconst unique = new Map();\r\n\t\tbranchGuides.forEach((guide) => {\r\n\t\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\t\tunique.set(key, guide);\r\n\t\t});\r\n\t\treturn [...unique.values()];\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tthis.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\tapplyScroll = (dist) => {\r\n\t\tthis.ref.current.scrollTop += dist * this.state.lineHeight;\r\n\t}\r\n\r\n\tonScroll(ev) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst { bufferTop, bufferBottom } = this.bufferRange();\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\t\t\tlet { start, end } = this.state.range;\r\n\r\n\t\t\tif (bufferTop < minBuffer) {\r\n\t\t\t\tstart -= minBuffer * 4;\r\n\t\t\t} else if (bufferTop > maxBuffer) {\r\n\t\t\t\tstart += Math.max(minBuffer, bufferTop - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (bufferBottom < minBuffer) {\r\n\t\t\t\tend += minBuffer * 4;\r\n\t\t\t} else if (bufferBottom > maxBuffer) {\r\n\t\t\t\tend -= Math.max(minBuffer, bufferBottom - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\treturn this.updateDisasmNow(false, { address: start, end });\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n\t}\r\n\r\n\tbufferRange() {\r\n\t\tconst { scrollHeight, scrollTop, clientHeight } = this.ref.current;\r\n\t\tconst bufferTop = scrollTop / this.state.lineHeight;\r\n\t\tconst bufferBottom = (scrollHeight - scrollTop - clientHeight) / this.state.lineHeight;\r\n\t\tconst visibleEachDirection = Math.floor((this.state.visibleLines - 1) / 2);\r\n\r\n\t\treturn {\r\n\t\t\tbufferTop: bufferTop + visibleEachDirection,\r\n\t\t\tbufferBottom: bufferBottom + visibleEachDirection,\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst { selectionTop, selectionBottom } = nextProps;\r\n\t\tif (prevState.cursor < selectionTop || prevState.cursor > selectionBottom) {\r\n\t\t\tlet cursor = selectionTop;\r\n\t\t\tif (prevState.lines.length) {\r\n\t\t\t\t// Snap to in case we goto an address in the middle\r\n\t\t\t\tconst line = prevState.lines.find(l => l.address <= selectionTop && l.address + l.addressSize > selectionTop);\r\n\t\t\t\tcursor = line ? line.address : cursor;\r\n\t\t\t}\r\n\t\t\treturn { cursor };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasm.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tpaused: PropTypes.bool.isRequired,\r\n\tpc: PropTypes.number,\r\n\tsetInitialPC: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Disasm;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './DisasmButtons.css';\r\n\r\nclass DisasmButtons extends PureComponent {\r\n\tstate = {\r\n\t\tbreakpointModalOpen: false,\r\n\t\tconnected: false,\r\n\t\tlastThread: '',\r\n\t\tthreads: [],\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst disabled = !this.props.started || !this.props.stepping;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"DisasmButtons\">\r\n\t\t\t\t<div className=\"DisasmButtons__group DisasmButtons__nav\">\r\n\t\t\t\t\t<button type=\"button\" onClick={this.props.showNavTray}>Nav</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" disabled={!this.props.started || this.props.paused} onClick={this.handleGoBreak}>\r\n\t\t\t\t\t\t{this.props.stepping || !this.props.started ? 'Go' : 'Break'}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepInto}>Step Into</button>\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOver}>Step Over</button>\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOut}>Step Out</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleNextHLE}>Next HLE</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" onClick={this.handleBreakpointOpen} disabled={!this.props.started}>Breakpoint</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<span className=\"DisasmButtons__thread-list\">\r\n\t\t\t\t\t\tThread: {this.renderThreadList()}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\t\t\tisOpen={this.state.breakpointModalOpen}\r\n\t\t\t\t\tonClose={this.handleBreakpointClose}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThreadList() {\r\n\t\tif (this.state.threads.length === 0) {\r\n\t\t\treturn '(none)';\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<select onChange={this.handleThreadSelect} value={this.props.currentThread || this.state.lastThread}>\r\n\t\t\t\t{this.state.threads.map(thread => this.renderThread(thread))}\r\n\t\t\t</select>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThread(thread) {\r\n\t\tconst classes = 'DisasmButtons__thread' + (thread.isCurrent ? ' DisasmButtons__thread--current' : '');\r\n\t\treturn (\r\n\t\t\t<option key={thread.id} value={thread.id} className={classes}>\r\n\t\t\t\t{thread.name}{thread.isCurrent ? ' (current)' : ''}\r\n\t\t\t</option>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'cpu.stepping': () => this.updateThreadList(true),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateThreadList(this.props.currentThread === undefined);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateThreadList(resetCurrentThread) {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'hle.thread.list',\r\n\t\t}).then(({ threads }) => {\r\n\t\t\tthis.setState({ threads });\r\n\t\t\tif (resetCurrentThread) {\r\n\t\t\t\tconst currentThread = threads.find(th => th.isCurrent);\r\n\t\t\t\tif (currentThread && currentThread.id !== this.props.currentThread) {\r\n\t\t\t\t\tthis.props.updateCurrentThread(currentThread.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ threads: [] });\r\n\t\t});\r\n\t}\r\n\r\n\thandleGoBreak = () => {\r\n\t\tif (this.props.stepping) {\r\n\t\t\tthis.props.updateCurrentThread(undefined);\r\n\t\t}\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: this.props.stepping ? 'cpu.resume' : 'cpu.stepping',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepInto = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepInto',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOver = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOver',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOut = () => {\r\n\t\tconst threadID = this.props.currentThread;\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOut',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// This might fail if they aren't inside a function call on this thread, so restore the thread.\r\n\t\t\tthis.props.updateCurrentThread(threadID);\r\n\t\t});\r\n\t}\r\n\r\n\thandleNextHLE = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.nextHLE',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleThreadSelect = (ev) => {\r\n\t\tconst currentThread = this.state.threads.find(th => th.id === Number(ev.target.value));\r\n\t\tif (currentThread) {\r\n\t\t\tthis.props.updateCurrentThread(currentThread.id, currentThread.pc);\r\n\t\t}\r\n\t}\r\n\r\n\thandleBreakpointOpen = () => {\r\n\t\tthis.setState({ breakpointModalOpen: true });\r\n\t}\r\n\r\n\thandleBreakpointClose = () => {\r\n\t\tthis.setState({ breakpointModalOpen: false });\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.currentThread && nextProps.currentThread !== prevState.lastThread) {\r\n\t\t\tupdate = { ...update, lastThread: nextProps.currentThread || '' };\r\n\t\t}\r\n\t\tif (nextProps.stepping || nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.threads.length) {\r\n\t\t\tupdate = { ...update, threads: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nDisasmButtons.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tpaused: PropTypes.bool.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\tshowNavTray: PropTypes.func.isRequired,\r\n\r\n\tupdateCurrentThread: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmButtons;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './GotoBox.css';\r\n\r\nclass GotoBox extends PureComponent {\r\n\tstate = {\r\n\t\taddress: '',\r\n\t};\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\t/* eslint no-script-url: \"off\" */\r\n\t\tconst disabled = !this.props.started;\r\n\t\treturn (\r\n\t\t\t<form action=\"#\" className=\"GotoBox\" onSubmit={this.handleSubmit}>\r\n\t\t\t\t<label className=\"GotoBox__label\" htmlFor=\"GotoBox__address\">Go to:</label>\r\n\t\t\t\t<input ref={this.ref}\r\n\t\t\t\t\ttype=\"text\" id=\"GotoBox__address\"\r\n\t\t\t\t\tvalue={this.state.address} onChange={this.handleChange}\r\n\t\t\t\t\ttitle=\"Hexadecimal address or expression, enter to submit\"\r\n\t\t\t\t\tautoComplete=\"off\"\r\n\t\t\t\t/>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handlePC} disabled={disabled}>PC</button>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handleRA} disabled={disabled}>RA</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.promptGotoMarker !== prevProps.promptGotoMarker) {\r\n\t\t\tthis.ref.current.focus();\r\n\t\t\tthis.ref.current.select();\r\n\t\t}\r\n\t}\r\n\r\n\tjumpToReg(name) {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.getReg',\r\n\t\t\tname,\r\n\t\t}).then((result) => {\r\n\t\t\tif (this.props.started) {\r\n\t\t\t\tthis.props.gotoDisasm(result.uintValue);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.setState({ address: ev.target.value });\r\n\t}\r\n\r\n\thandleSubmit = (ev) => {\r\n\t\tif (this.props.started) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\texpression: this.state.address,\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tif (this.props.started) {\r\n\t\t\t\t\tthis.props.gotoDisasm(uintValue);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandlePC = (ev) => {\r\n\t\tthis.jumpToReg('pc');\r\n\t}\r\n\r\n\thandleRA = (ev) => {\r\n\t\tthis.jumpToReg('ra');\r\n\t}\r\n}\r\n\r\nGotoBox.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default GotoBox;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { AutoSizer, List } from 'react-virtualized';\r\nimport listeners from '../../utils/listeners.js';\r\nimport 'react-virtualized/styles.css';\r\nimport './FuncList.css';\r\n\r\nclass FuncList extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\t// Lots of functions can take a while...\r\n\t\tloading: true,\r\n\t\trowHeight: null,\r\n\t\tfunctions: [],\r\n\t\tfilter: '',\r\n\t\tfilteredFunctions: [],\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { filter } = this.state;\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList\">\r\n\t\t\t\t<input type=\"search\" className=\"FuncList__search\" value={filter} onChange={this.handleFilter} />\r\n\t\t\t\t{this.renderList()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderList() {\r\n\t\tconst { filter, loading, rowHeight } = this.state;\r\n\t\tif (loading || !rowHeight) {\r\n\t\t\treturn <div className=\"FuncList__loading\">Loading...</div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList__listing\" onClick={this.handleClick}>\r\n\t\t\t\t<AutoSizer filter={filter}>{this.renderSizedList}</AutoSizer>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderSizedList = ({ height, width }) => {\r\n\t\tconst { filter, filteredFunctions, rowHeight } = this.state;\r\n\t\treturn (\r\n\t\t\t<List\r\n\t\t\t\theight={height}\r\n\t\t\t\trowHeight={rowHeight}\r\n\t\t\t\trowRenderer={this.renderFunc}\r\n\t\t\t\twidth={width}\r\n\t\t\t\trowCount={filteredFunctions.length}\r\n\t\t\t\tfilter={filter}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\trenderFunc = ({ index, key, style }) => {\r\n\t\tconst func = this.state.filteredFunctions[index];\r\n\t\treturn (\r\n\t\t\t<div key={key + '-' + func.address} style={style}>\r\n\t\t\t\t<button type=\"button\" data-address={func.address}>{func.name}</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'game.start': () => this.updateList(),\r\n\t\t});\r\n\t\tif (this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tmeasureHeight() {\r\n\t\tconst node = document.querySelector('.FuncList__loading');\r\n\t\tif (node) {\r\n\t\t\tconst rowHeight = node.getBoundingClientRect().height;\r\n\t\t\tthis.setState({ rowHeight });\r\n\t\t}\r\n\t}\r\n\r\n\tupdateList() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.state.loading && this.state.functions.length === 0) {\r\n\t\t\tthis.setState({ loading: true });\r\n\t\t}\r\n\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'hle.func.list',\r\n\t\t}).then(({ functions }) => {\r\n\t\t\tfunctions.sort((a, b) => a.name.localeCompare(b.name));\r\n\t\t\tconst filteredFunctions = this.applyFilter(functions, this.state.filter);\r\n\t\t\tthis.setState({ functions, filteredFunctions, loading: false });\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ functions: [], filteredFunctions: [], loading: false });\r\n\t\t});\r\n\t}\r\n\r\n\tapplyFilter(functions, filter) {\r\n\t\tif (filter === '') {\r\n\t\t\treturn functions;\r\n\t\t}\r\n\t\tconst match = filter.toLowerCase();\r\n\t\treturn functions.filter(func => func.name.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\thandleFilter = (ev) => {\r\n\t\tconst filter = ev.target.value;\r\n\t\tconst filteredFunctions = this.applyFilter(this.state.functions, filter);\r\n\t\tthis.setState({ filter, filteredFunctions });\r\n\t}\r\n\r\n\thandleClick = (ev) => {\r\n\t\tconst { address } = ev.target.dataset;\r\n\t\tthis.props.gotoDisasm(Number(address));\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.functions.length) {\r\n\t\t\tupdate = { ...update, functions: [], filteredFunctions: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nFuncList.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default FuncList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView, hasContextMenu } from '../../utils/dom';\r\nimport classNames from 'clsx';\r\n\r\nclass RegList extends PureComponent {\r\n\tstate = {\r\n\t\tcursor: 0,\r\n\t};\r\n\tcursorRef;\r\n\tneedsScroll = false;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.cursorRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<dl>\r\n\t\t\t\t{this.props.registerNames.map((name, reg) => {\r\n\t\t\t\t\treturn this.renderReg(name, reg);\r\n\t\t\t\t})}\r\n\t\t\t</dl>\r\n\t\t);\r\n\t}\r\n\r\n\trenderReg(name, reg) {\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { cat: this.props.id, reg, value: this.format(reg) };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\tonMouseDown: (ev) => this.setState({ cursor: reg }),\r\n\t\t\tonKeyDown: (ev) => this.onKeyDown(ev),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\t\tconst ddClasses = {\r\n\t\t\t'RegPanel__item--changed': this.changed(reg),\r\n\t\t\t'RegPanel__item--selected': this.state.cursor === reg,\r\n\t\t};\r\n\t\tconst ref = this.state.cursor === reg ? this.cursorRef : undefined;\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" attributes={attributes} collect={mapData} holdToDisplay={-1} key={reg}>\r\n\t\t\t\t<dt>{name}</dt>\r\n\t\t\t\t<dd className={classNames(ddClasses)} ref={ref}>\r\n\t\t\t\t\t{this.format(reg)}\r\n\t\t\t\t</dd>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\tformat(reg) {\r\n\t\tif (this.props.id === 0) {\r\n\t\t\treturn toString08X(this.props.uintValues[reg]);\r\n\t\t} else {\r\n\t\t\treturn this.props.floatValues[reg];\r\n\t\t}\r\n\t}\r\n\r\n\tchanged(reg) {\r\n\t\treturn this.props.uintValues[reg] !== this.props.uintValuesLast[reg];\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.cursorRef.current) {\r\n\t\t\tconst triggerNode = this.cursorRef.current.parentNode;\r\n\t\t\tensureInView(triggerNode, { block: 'nearest' });\r\n\t\t\ttriggerNode.focus();\r\n\t\t\tthis.needsScroll = false;\r\n\t\t}\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowUp' && this.state.cursor > 0) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState({ cursor: this.state.cursor - 1 });\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowDown' && this.state.cursor < this.props.registerNames.length - 1) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState({ cursor: this.state.cursor + 1 });\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nRegList.propTypes = {\r\n\tid: PropTypes.number.isRequired,\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tregisterNames: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValues: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValues: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValuesLast: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValuesLast: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n};\r\n\r\nexport default RegList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem } from 'react-contextmenu';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport RegList from './RegList';\r\nimport listeners from '../../utils/listeners.js';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport './RegPanel.css';\r\nimport '../ext/react-contextmenu.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass RegPanel extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"RegPanel\">\r\n\t\t\t\t{this.renderTabs()}\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderTabs() {\r\n\t\tconst { categories } = this.state;\r\n\t\t// Seems react-tabs is buggy when tabs are initially empty.\r\n\t\tif (categories.length === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Tabs>\r\n\t\t\t\t<TabList>\r\n\t\t\t\t\t{categories.map(c => <Tab key={c.id}>{c.name}</Tab>)}\r\n\t\t\t\t</TabList>\r\n\t\t\t\t{categories.map(c => (\r\n\t\t\t\t\t<TabPanel key={c.id}>\r\n\t\t\t\t\t\t<RegList contextmenu=\"reglist\" onDoubleClick={this.handleChangeReg} {...c} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t))}\r\n\t\t\t</Tabs>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\tconst disabled = !this.props.stepping;\r\n\t\treturn (\r\n\t\t\t<ContextMenu id=\"reglist\">\r\n\t\t\t\t<MenuItem onClick={this.handleViewMemory}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleViewDisassembly}>\r\n\t\t\t\t\tGo to in Disassembly\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem onClick={this.handleCopyReg}>\r\n\t\t\t\t\tCopy Value\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleChangeReg}>\r\n\t\t\t\t\tChange...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.updateRegs(false),\r\n\t\t\t'cpu.stepping': () => this.updateRegs(false),\r\n\t\t\t'cpu.setReg': (result) => this.updateReg(result),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.currentThread && this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tthis.updateRegs(true);\r\n\t\t}\r\n\t}\r\n\r\n\thandleViewMemory = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t}\r\n\r\n\thandleViewDisassembly = (ev, data) => {\r\n\t\tconst uintValue = this.state.categories[data.cat].uintValues[data.reg];\r\n\t\tthis.props.gotoDisasm(uintValue);\r\n\t}\r\n\r\n\thandleCopyReg = (ev, data, regNode) => {\r\n\t\tcopyText(data.value);\r\n\t}\r\n\r\n\thandleChangeReg = (ev, data, regNode) => {\r\n\t\tconst prevValue = (data.cat === 0 ? '0x' : '') + data.value;\r\n\t\tconst registerName = this.state.categories[data.cat].registerNames[data.reg];\r\n\r\n\t\tconst newValue = window.prompt('New value for ' + registerName, prevValue);\r\n\t\tif (newValue === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst packet = {\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\tcategory: data.cat,\r\n\t\t\tregister: data.reg,\r\n\t\t\tvalue: newValue,\r\n\t\t};\r\n\r\n\t\t// The result is automatically listened for.\r\n\t\tthis.props.ppsspp.send(packet).catch((err) => {\r\n\t\t\twindow.alert(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateRegs(keepLast) {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.getAllRegs',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).then((result) => {\r\n\t\t\tlet { categories } = result;\r\n\t\t\t// Add values for change tracking.\r\n\t\t\tconst hasPrev = this.state.categories.length !== 0;\r\n\t\t\tfor (let cat of categories) {\r\n\t\t\t\tconst prevCat = hasPrev ? this.state.categories[cat.id] : null;\r\n\t\t\t\tcat.uintValuesLast = hasPrev ? (keepLast ? prevCat.uintValuesLast : prevCat.uintValues) : cat.uintValues;\r\n\t\t\t\tcat.floatValuesLast = hasPrev ? (keepLast ? prevCat.floatValuesLast : prevCat.floatValues) : cat.floatValues;\r\n\t\t\t}\r\n\t\t\tthis.setState({ categories });\r\n\t\t}, (err) => {\r\n\t\t\t// Leave regs alone.\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateReg(result) {\r\n\t\tconst replaceCopy = (arr, index, item) => {\r\n\t\t\treturn arr.slice(0, index).concat([item]).concat(arr.slice(index + 1));\r\n\t\t};\r\n\r\n\t\tconst categories = this.state.categories.map((cat) => {\r\n\t\t\tif (cat.id === result.category) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...cat,\r\n\t\t\t\t\t// Keep values from last time, until next stepping.\r\n\t\t\t\t\tuintValuesLast: cat.uintValuesLast,\r\n\t\t\t\t\tfloatValuesLast: cat.floatValuesLast,\r\n\t\t\t\t\tuintValues: replaceCopy(cat.uintValues, result.register, result.uintValue),\r\n\t\t\t\t\tfloatValues: replaceCopy(cat.floatValues, result.register, result.floatValue),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn cat;\r\n\t\t});\r\n\r\n\t\tthis.setState({ categories });\r\n\t}\r\n}\r\n\r\nRegPanel.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nexport default RegPanel;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport listeners from '../../utils/listeners';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './VisualizeVFPU.css';\r\n\r\n// TODO: Consider using react-new-window for desktop?\r\n\r\nclass VisualizeVFPU extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t\tformat: 'float',\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { categories, format } = this.state;\r\n\t\tif (categories.length < 3) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet matrices = [];\r\n\t\tfor (let m = 0; m < categories[2].uintValues.length / 16; ++m) {\r\n\t\t\tmatrices.push(this.renderMatrix(m));\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal contentLabel=\"VFPU\" isOpen={this.props.isOpen} onClose={this.props.onClose}>\r\n\t\t\t\t<h2>VFPU Registers</h2>\r\n\t\t\t\t<div className=\"VisualizeVFPU__list\">\r\n\t\t\t\t\t{matrices}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"VisualizeVFPU__format\">\r\n\t\t\t\t\tDisplay as:\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'float'} value=\"float\" onChange={this.handleFormat} /> Float</label>\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'uint'} value=\"uint\" onChange={this.handleFormat} /> Hex</label>\r\n\t\t\t\t</div>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMatrix(m) {\r\n\t\treturn (\r\n\t\t\t<table className=\"VisualizeVFPU__matrix\" key={m}>\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__name\">M{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}01</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}02</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}03</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</thead>\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t{this.renderColumn(m, 0)}\r\n\t\t\t\t\t{this.renderColumn(m, 1)}\r\n\t\t\t\t\t{this.renderColumn(m, 2)}\r\n\t\t\t\t\t{this.renderColumn(m, 3)}\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t);\r\n\t}\r\n\r\n\trenderColumn(m, c) {\r\n\t\treturn (\r\n\t\t\t<tr key={c}>\r\n\t\t\t\t<th className=\"VisualizeVFPU__col-header\">C{m}{c}0</th>\r\n\t\t\t\t<td>{this.renderValue(m, c, 0)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 1)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 2)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 3)}</td>\r\n\t\t\t</tr>\r\n\t\t);\r\n\t}\r\n\r\n\trenderValue(m, c, r) {\r\n\t\tconst reg = m * 4 + c * 32 + r;\r\n\t\tconst cat = this.state.categories[2];\r\n\t\tif (this.state.format === 'uint') {\r\n\t\t\treturn toString08X(cat.uintValues[reg]);\r\n\t\t}\r\n\t\treturn cat.floatValues[reg];\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'cpu.getAllRegs': ({ categories }) => this.setState({ categories }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\thandleFormat = (ev) => {\r\n\t\tconst format = ev.target.value;\r\n\t\tthis.setState({ format });\r\n\t}\r\n}\r\n\r\nVisualizeVFPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default VisualizeVFPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport FuncList from './FuncList';\r\nimport RegPanel from './RegPanel';\r\nimport VisualizeVFPU from './VisualizeVFPU';\r\nimport './LeftPanel.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass LeftPanel extends PureComponent {\r\n\tstate = {\r\n\t\tvfpuModalOpen: false,\r\n\t\t// These can be slow, so we want to prevent render until it's selected.\r\n\t\teverShownFuncs: false,\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"LeftPanel\">\r\n\t\t\t\t<Tabs onSelect={this.handleSelect}>\r\n\t\t\t\t\t<TabList>\r\n\t\t\t\t\t\t<Tab>Regs</Tab>\r\n\t\t\t\t\t\t<Tab>Funcs</Tab>\r\n\t\t\t\t\t\t<Tab>Tools</Tab>\r\n\t\t\t\t\t</TabList>\r\n\t\t\t\t\t<TabPanel forceRender={true}>\r\n\t\t\t\t\t\t<RegPanel {...this.props} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel forceRender={this.state.everShownFuncs}>\r\n\t\t\t\t\t\t<FuncList {...this.props} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel className=\"react-tabs__tab-panel LeftPanel__tools\">\r\n\t\t\t\t\t\t<button type=\"button\" onClick={this.handleVFPUOpen}>Visualize VFPU</button>\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t</Tabs>\r\n\r\n\t\t\t\t<VisualizeVFPU {...this.props} isOpen={this.state.vfpuModalOpen} onClose={this.handleVFPUClose} />\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\thandleSelect = (index) => {\r\n\t\tif (index === 1 && !this.state.everShownFuncs) {\r\n\t\t\tthis.setState({ everShownFuncs: true });\r\n\t\t}\r\n\t}\r\n\r\n\thandleVFPUOpen = () => {\r\n\t\tthis.setState({ vfpuModalOpen: true });\r\n\t}\r\n\r\n\thandleVFPUClose = () => {\r\n\t\tthis.setState({ vfpuModalOpen: false });\r\n\t}\r\n}\r\n\r\nLeftPanel.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nexport default LeftPanel;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Disasm from './CPU/Disasm';\r\nimport DisasmButtons from './CPU/DisasmButtons';\r\nimport GotoBox from './CPU/GotoBox';\r\nimport LeftPanel from './CPU/LeftPanel';\r\nimport listeners from '../utils/listeners.js';\r\nimport './CPU.css';\r\n\r\nclass CPU extends PureComponent {\r\n\tstate = {\r\n\t\tstepping: false,\r\n\t\tpaused: true,\r\n\t\tstarted: false,\r\n\t\tpc: 0,\r\n\t\tsetInitialPC: false,\r\n\t\t// Note: these are inclusive.\r\n\t\tselectionTop: null,\r\n\t\tselectionBottom: null,\r\n\t\tjumpMarker: null,\r\n\t\tpromptGotoMarker: null,\r\n\t\tlastTicks: 0,\r\n\t\tticks: 0,\r\n\t\tcurrentThread: undefined,\r\n\t\tnavTray: false,\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { paused, stepping, started, currentThread, navTray } = this.state;\r\n\t\tconst commonProps = { stepping: stepping && !paused, paused, started, currentThread };\r\n\t\tconst { selectionTop, selectionBottom, jumpMarker, pc, setInitialPC } = this.state;\r\n\t\tconst disasmProps = { ...commonProps, selectionTop, selectionBottom, jumpMarker, pc, setInitialPC };\r\n\r\n\t\treturn (\r\n\t\t\t<div id=\"CPU\">\r\n\t\t\t\t<div className={navTray ? 'CPU__pane CPU__pane--open' : 'CPU__pane'}>\r\n\t\t\t\t\t<button type=\"button\" onClick={this.hideNavTray} className=\"CPU__paneClose\">Close</button>\r\n\t\t\t\t\t<GotoBox ppsspp={this.props.ppsspp} {...commonProps} gotoDisasm={this.gotoDisasm} promptGotoMarker={this.state.promptGotoMarker} />\r\n\t\t\t\t\t<LeftPanel {...this.props} {...commonProps} gotoDisasm={this.gotoDisasm} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"Disasm__container\">\r\n\t\t\t\t\t<DisasmButtons {...this.props} {...commonProps} updateCurrentThread={this.updateCurrentThread} showNavTray={this.showNavTray} />\r\n\t\t\t\t\t<Disasm {...this.props} {...disasmProps} updateSelection={this.updateSelection} promptGoto={this.promptGoto} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\r\n\t\t\t'cpu.resume': () => this.setState({ stepping: false }),\r\n\t\t\t'game.start': () => {\r\n\t\t\t\t// This may often not happen if the register list is visible.\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.updateInitialPC();\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ started: true, paused: false });\r\n\t\t\t},\r\n\t\t\t'game.quit': () => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tstarted: false,\r\n\t\t\t\t\tstepping: false,\r\n\t\t\t\t\tpaused: true,\r\n\t\t\t\t\tpc: 0,\r\n\t\t\t\t\tsetInitialPC: false,\r\n\t\t\t\t\tcurrentThread: undefined,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tconst pc = result.uintValue;\r\n\t\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.getAllRegs': (result) => {\r\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, stepping: false, paused: true });\r\n\t\tif (!connected) {\r\n\t\t\tthis.setState({ currentThread: undefined });\r\n\t\t}\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc, ticks } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ connected: true, started, stepping, paused, pc, setInitialPC: pc !== 0, ticks, lastTicks: ticks });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ stepping: false, paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tonStepping(data) {\r\n\t\tthis.setState({\r\n\t\t\tstepping: true,\r\n\t\t\tpc: data.pc,\r\n\t\t\tselectionTop: data.pc,\r\n\t\t\tselectionBottom: data.pc,\r\n\t\t\tlastTicks: this.state.ticks,\r\n\t\t\tticks: data.ticks,\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSelection = (data) => {\r\n\t\tthis.setState(data);\r\n\t}\r\n\r\n\tgotoDisasm = (pc) => {\r\n\t\tthis.setState({\r\n\t\t\tselectionTop: pc,\r\n\t\t\tselectionBottom: pc,\r\n\t\t\t// It just matters that this is a new object.\r\n\t\t\tjumpMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tpromptGoto = () => {\r\n\t\tthis.setState({\r\n\t\t\tpromptGotoMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tupdateCurrentThread = (currentThread, pc) => {\r\n\t\tthis.setState({ currentThread, pc, setInitialPC: pc !== 0 });\r\n\t\tif (pc) {\r\n\t\t\tthis.gotoDisasm(pc);\r\n\t\t}\r\n\t}\r\n\r\n\tshowNavTray = () => {\r\n\t\tthis.setState({ navTray: true });\r\n\t}\r\n\r\n\thideNavTray = () => {\r\n\t\tthis.setState({ navTray: false });\r\n\t}\r\n\r\n\tupdateInitialPC = () => {\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.getReg', name: 'pc' }).then(result => {\r\n\t\t\tconst pc = result.uintValue;\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t});\r\n\t}\r\n}\r\n\r\nCPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default CPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport listeners from '../utils/listeners.js';\r\nimport './GPU.css';\r\n\r\nclass GPU extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tstarted: false,\r\n\t\tpaused: true,\r\n\t\trecording: false,\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"GPU\">\r\n\t\t\t\t<div className=\"GPU__info\">\r\n\t\t\t\t\t{this.state.started && !this.state.paused ? 'Click below to generate a GE dump.  It will download as a file.' : 'Waiting for a game to start...'}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.state.started && !this.state.paused ? (\r\n\t\t\t\t\t<form className=\"GPU__form\" onSubmit={this.beginRecord}>\r\n\t\t\t\t\t\t<button disabled={this.state.recording}>{this.state.recording ? 'Recording...' : 'Record'}</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'game.start': () => this.setState({ started: true, paused: false }),\r\n\t\t\t'game.quit': () => this.setState({ started: false, paused: true }),\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, paused: true });\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tthis.setState({ connected: true, started, paused });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tbeginRecord = (ev) => {\r\n\t\tthis.setState({ recording: true });\r\n\t\tthis.props.ppsspp.send({ event: 'gpu.record.dump' }).then(result => {\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.setAttribute('download', 'recording.ppdmp');\r\n\t\t\ta.href = result.uri;\r\n\t\t\ta.hidden = true;\r\n\t\t\tdocument.body.appendChild(a);\r\n\t\t\ta.click();\r\n\t\t\tdocument.body.removeChild(a);\r\n\r\n\t\t\tthis.setState({ recording: false });\r\n\t\t});\r\n\t\tev.preventDefault();\r\n\t}\r\n}\r\n\r\nGPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default GPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\n\r\nclass LogItem extends PureComponent {\r\n\trender() {\r\n\t\tif (this.props.item.event === 'log') {\r\n\t\t\treturn this.formatLogEvent();\r\n\t\t}\r\n\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\r\n\trenderInternal() {\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t{this.props.item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tformatLogEvent() {\r\n\t\tconst { item } = this.props;\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t<span className=\"Log__message__header\">\r\n\t\t\t\t\t<span className=\"Log__message__timestamp\">{item.timestamp}</span>\r\n\t\t\t\t\t{' ' + item.header + ' '}\r\n\t\t\t\t</span>\r\n\t\t\t\t{item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tmakeClassName() {\r\n\t\tconst { item } = this.props;\r\n\r\n\t\treturn classNames('Log__message', {\r\n\t\t\t'Log__message--internal': item.event !== 'log',\r\n\t\t\t['Log__message--channel-' + item.channel]: item.event === 'log',\r\n\t\t\t['Log__message--level-' + item.level]: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nLogItem.propTypes = {\r\n\titem: PropTypes.shape({\r\n\t\tevent: PropTypes.string,\r\n\t\tchannel: PropTypes.string,\r\n\t\tlevel: PropTypes.number,\r\n\t\ttimestamp: PropTypes.string,\r\n\t\theader: PropTypes.string,\r\n\t\tmessage: PropTypes.string.isRequired,\r\n\t}).isRequired,\r\n};\r\n\r\nexport default LogItem;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport LogItem from './LogItem';\r\nimport listeners from '../utils/listeners.js';\r\nimport './Log.css';\r\n\r\nconst MAX_LINES = 5000;\r\n\r\nclass Log extends PureComponent {\r\n\tstate = {\r\n\t\tid: 0,\r\n\t\titems: [],\r\n\t};\r\n\tdivRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.divRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"Log\" ref={this.divRef}>\r\n\t\t\t\t{this.state.items.map(this.renderItem.bind(this))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderItem(item) {\r\n\t\treturn <LogItem key={item.id} item={item} />;\r\n\t}\r\n\r\n\taddLogItem(newItem) {\r\n\t\tconst id = this.state.id + 1;\r\n\t\tconst itemWithId = { id, ...newItem };\r\n\t\tconst items = this.state.items.concat([itemWithId ]).slice(-MAX_LINES);\r\n\t\tthis.setState({\r\n\t\t\tid,\r\n\t\t\titems,\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.ppsspp.onError = (message, level) => {\r\n\t\t\tconst newItem = { message: message + '\\n', level };\r\n\t\t\tthis.addLogItem(newItem);\r\n\t\t};\r\n\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'log': this.onLogEvent.bind(this),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevState.id !== this.state.id) {\r\n\t\t\tconst div = this.divRef.current;\r\n\t\t\tdiv.scrollTop = div.scrollHeight - div.clientHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonLogEvent(data) {\r\n\t\tconst newItem = { ...data };\r\n\t\tthis.addLogItem(newItem);\r\n\t}\r\n}\r\n\r\nLog.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default Log;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './NotConnected.css';\r\n\r\nexport default function NotConnected(props) {\r\n\tconst connectManually = (ev) => {\r\n\t\tconst uri = ev.target.elements['debugger-uri'].value;\r\n\t\tprops.connect(uri);\r\n\t\tev.preventDefault();\r\n\t};\r\n\tconst connectAutomatically = (ev) => {\r\n\t\tprops.connect(null);\r\n\t\tev.preventDefault();\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div id=\"NotConnected\">\r\n\t\t\t{props.connecting ? 'Connecting to PPSSPP...' : 'Not connected to PPSSPP'}\r\n\r\n\t\t\t<div className=\"NotConnected__info\">\r\n\t\t\t\tMake sure \"Allow remote debugger\" is enabled in Developer tools.\r\n\t\t\t</div>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectManually}>\r\n\t\t\t\t<input type=\"text\" name=\"debugger-uri\" placeholder=\"ws://ip:port/debugger\" className=\"NotConnected__uri\" />\r\n\t\t\t\t<button disabled={props.connecting}>Connect Manually</button>\r\n\t\t\t</form>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectAutomatically}>\r\n\t\t\t\t<button disabled={props.connecting}>Connect Automatically</button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nNotConnected.propTypes = {\r\n\tconnect: PropTypes.func.isRequired,\r\n};\r\n","// PPSSPP debugger API client\r\n//\r\n// Most operations use promises and are asynchronous.\r\n//\r\n// Example usage:\r\n//\r\n//    let ppsspp = new PPSSPP();\r\n//    ppsspp.listen('cpu.stepping', function () {\r\n//        console.log('Hit a breakpoint');\r\n//    });\r\n//    ppsspp.autoConnect().then(function () {\r\n//        return ppsspp.send({ event: 'cpu.getReg', name: 'pc' });\r\n//    }).then(function (result) {\r\n//        console.log('pc: ', result.uintValue);\r\n//    }).catch(function (err) {\r\n//        console.log('Something went wrong', err);\r\n//    });\r\n//\r\n// Methods:\r\n//  - autoConnect(): Find and connect to PPSSPP automatically.  Returns a promise.\r\n//  - connect(uri): Connect to a specific WebSocket URI (begins with ws://.)  Returns a promise.\r\n//  - disconnect(): Disconnect from PPSSPP.  No return.\r\n//  - listen(name, handler): Adds a listener for unsolicited events (e.g. 'log') or '*' for all.  No return.\r\n//      The handler takes two parameter, the data object, and whether any previous handler returned true.\r\n//  - send(object): Send an event to PPSSPP.  Returns a promise resolving to the data object.\r\n//      Note that not all PPSSPP events have a response.  You may receive null or it may never resolve.\r\n//\r\n// Properties:\r\n//  - onError: Set this to a function receiving (message, level) for errors.\r\n//  - onClose: Set this to a function with no parameters called when on disconnect.\r\n//\r\n// For documentation on the actual events for send() and listen(), look in PPSSPP's source code.\r\n// Start with the comment in Core/Debugger/WebSocket.cpp.\r\n// Individual files in Core/Debugger/WebSocket/ also have comments describing the events and parameters.\r\n\r\n// We fast-resolve these to avoid confusion.\r\nconst NoResponseEvents = [\r\n\t'cpu.stepping',\r\n\t'cpu.resume',\r\n];\r\n\r\nconst ErrorLevels = {\r\n\tNOTICE: 1,\r\n\tERROR: 2,\r\n\tWARN: 3,\r\n\tINFO: 4,\r\n\tDEBUG: 5,\r\n\tVERBOSE: 6,\r\n};\r\n\r\nconst PPSSPP_MATCH_API = '//report.ppsspp.org/match/list';\r\nconst PPSSPP_SUB_PROTOCOL = 'debugger.ppsspp.org';\r\nconst PPSSPP_DEFAULT_PATH = '/debugger';\r\n\r\nexport default class PPSSPP {\r\n\tautoConnect() {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\tlet err = new Error('Couldn\\'t connect');\r\n\r\n\t\treturn fetch(PPSSPP_MATCH_API).then((response) => {\r\n\t\t\treturn response.json();\r\n\t\t}).then((listing) => {\r\n\t\t\treturn this.tryNextEndpoint_(listing);\r\n\t\t}).then(this.setupSocket_.bind(this), specificError => {\r\n\t\t\terr.message = specificError.message;\r\n\t\t\terr.originalError = specificError;\r\n\t\t\tthrow err;\r\n\t\t});\r\n\t}\r\n\r\n\tconnect(uri) {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\t// In case it fails, prepare the error (and stack trace) now.\r\n\t\tlet err = new Error('Couldn\\'t connect to ' + uri);\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst possibleSocket = new WebSocket(uri, PPSSPP_SUB_PROTOCOL);\r\n\r\n\t\t\tpossibleSocket.onopen = () => {\r\n\t\t\t\tthis.socket_ = possibleSocket;\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\t\t\tpossibleSocket.onclose = () => {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t}).then(this.setupSocket_.bind(this));\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\tthrow new Error('Not connected');\r\n\t\t}\r\n\r\n\t\tthis.failAllPending_('Disconnected from PPSSPP');\r\n\r\n\t\tthis.socket_.close(1000);\r\n\t\tthis.socket_ = null;\r\n\t}\r\n\r\n\tlisten(eventName, handler) {\r\n\t\tif (!(eventName in this.listeners_)) {\r\n\t\t\tthis.listeners_[eventName] = [];\r\n\t\t}\r\n\r\n\t\tthis.listeners_[eventName].push(handler);\r\n\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst list = this.listeners_[eventName];\r\n\t\t\t\tconst index = list.indexOf(handler);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tlist.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tsend(data) {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\treturn Promise.reject(new Error('Not connected'));\r\n\t\t}\r\n\r\n\t\t// Prepare a stack trace now, not when resolving (since that will trace to the onmessage.)\r\n\t\tlet err = new Error('PPSSPP returned an error');\r\n\r\n\t\t// Avoid confusion by resolving immediately for known no-response events.\r\n\t\tif (NoResponseEvents.includes(data.event)) {\r\n\t\t\tthis.socket_.send(JSON.stringify(data));\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst ticket = this.makeTicket_();\r\n\r\n\t\t\tthis.pendingTickets_[ticket] = function (result) {\r\n\t\t\t\tif (result.event === 'error') {\r\n\t\t\t\t\terr.name = 'DebuggerError';\r\n\t\t\t\t\terr.message = result.message;\r\n\t\t\t\t\terr.originalMessage = result;\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.socket_.send(JSON.stringify({ ...data, ticket }));\r\n\t\t});\r\n\t}\r\n\r\n\tsetupSocket_() {\r\n\t\tthis.socket_.onclose = () => {\r\n\t\t\tif (this.onClose) {\r\n\t\t\t\tthis.onClose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.failAllPending_('PPSSPP disconnected');\r\n\t\t\tthis.socket_ = null;\r\n\t\t};\r\n\r\n\t\tthis.socket_.onmessage = (e) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst data = JSON.parse(e.data);\r\n\r\n\t\t\t\tif (data.event === 'error') {\r\n\t\t\t\t\tthis.handleError_(data.message, data.level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet handled = false;\r\n\t\t\t\tif ('ticket' in data) {\r\n\t\t\t\t\thandled = this.handleTicket_(data.ticket, data);\r\n\t\t\t\t}\r\n\t\t\t\tthis.handleMessage_(data, handled);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthis.handleError_('Failed to parse message from PPSSPP: ' + err.message, ErrorLevels.ERROR);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\ttryNextEndpoint_(listing) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif (!listing || listing.length === 0) {\r\n\t\t\t\treturn reject(new Error('Couldn\\'t connect automatically.  Is PPSSPP connected to the same network?'));\r\n\t\t\t}\r\n\r\n\t\t\tconst endpoint = 'ws://' + listing[0].ip + ':' + listing[0].p + PPSSPP_DEFAULT_PATH;\r\n\t\t\treturn this.connect(endpoint).then(resolve, err => {\r\n\t\t\t\tif (listing.length > 1) {\r\n\t\t\t\t\tresolve(this.tryNextEndpoint_(listing.slice(1)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\thandleTicket_(ticket, data) {\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\tconst handler = this.pendingTickets_[data.ticket];\r\n\t\t\tdelete this.pendingTickets_[data.ticket];\r\n\r\n\t\t\thandler(data);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tthis.handleError_('Received mismatched ticket: ' + JSON.stringify(data), ErrorLevels.ERROR);\r\n\t\treturn false;\r\n\t}\r\n\r\n\thandleMessage_(data, handled) {\r\n\t\thandled = this.executeHandlers_(data.event, data, handled);\r\n\t\tthis.executeHandlers_('*', data, handled);\r\n\t}\r\n\r\n\texecuteHandlers_(name, data, handled) {\r\n\t\tif (name in this.listeners_) {\r\n\t\t\tfor (let handler of this.listeners_[name]) {\r\n\t\t\t\tif (handler(data, handled)) {\r\n\t\t\t\t\thandled = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn handled;\r\n\t}\r\n\r\n\thandleError_(message, level) {\r\n\t\tif (this.onError) {\r\n\t\t\tthis.onError(message, level);\r\n\t\t} else if (level === undefined || Number(level) === ErrorLevels.ERROR) {\r\n\t\t\tconsole.error(message);\r\n\t\t} else {\r\n\t\t\tconsole.log(message);\r\n\t\t}\r\n\t}\r\n\r\n\tmakeTicket_() {\r\n\t\tlet ticket = Math.random().toString(36).substr(2);\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\treturn this.makeTicket_();\r\n\t\t}\r\n\t\treturn ticket;\r\n\t}\r\n\r\n\tfailAllPending_(message) {\r\n\t\tconst data = { event: 'error', message, level: ErrorLevels.ERROR };\r\n\r\n\t\tfor (let ticket in this.pendingTickets_) {\r\n\t\t\tif (this.pendingTickets_.hasOwnProperty(ticket)) {\r\n\t\t\t\tthis.pendingTickets_[ticket](data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.pendingTickets_ = {};\r\n\t}\r\n\r\n\tonError = null;\r\n\tonClose = null;\r\n\r\n\tsocket_ = null;\r\n\tpendingTickets_ = {};\r\n\tlisteners_ = {};\r\n}\r\n\r\nexport { ErrorLevels };\r\n","export default __webpack_public_path__ + \"static/media/logo.752c728e.svg\";","import React, { Component } from 'react';\r\nimport { NavLink, BrowserRouter as Router, Route, Switch } from 'react-router-dom';\r\nimport CPU from './CPU';\r\nimport GPU from './GPU';\r\nimport Log from './Log';\r\nimport NotConnected from './NotConnected';\r\nimport PPSSPP from '../sdk/ppsspp.js';\r\nimport listeners from '../utils/listeners.js';\r\nimport logo from '../assets/logo.svg';\r\nimport './App.css';\r\n\r\nconst versionInfo = {\r\n\tname: process.env.REACT_APP_NAME,\r\n\tversion: process.env.REACT_APP_VERSION,\r\n};\r\n\r\nclass App extends Component {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tconnecting: false,\r\n\t};\r\n\tlogRef;\r\n\tppsspp;\r\n\toriginalTitle;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.logRef = React.createRef();\r\n\t\tthis.ppsspp = new PPSSPP();\r\n\t\tthis.originalTitle = document.title;\r\n\r\n\t\tlisteners.init(this.ppsspp);\r\n\t\tlisteners.listen({\r\n\t\t\t'connection.change': this.onConnectionChange,\r\n\t\t\t'game.start': this.updateTitle,\r\n\t\t\t'game.quit': this.updateTitle,\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t<div className=\"App\">\r\n\t\t\t\t\t<header className=\"App-header\">\r\n\t\t\t\t\t\t<ul className=\"App-nav\">\r\n\t\t\t\t\t\t\t<NavLink to=\"/cpu\">CPU</NavLink>\r\n\t\t\t\t\t\t\t<NavLink to=\"/gpu\">GPU</NavLink>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"PPSSPP\" />\r\n\t\t\t\t\t\t<h1 className=\"App-title\">Debugger</h1>\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t{this.renderContent()}\r\n\t\t\t\t\t<Log ppsspp={this.ppsspp} ref={this.logRef} />\r\n\t\t\t\t</div>\r\n\t\t\t</Router>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\treturn <NotConnected connecting={this.state.connecting} connect={this.connect} />;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route path=\"/gpu\">\r\n\t\t\t\t\t<GPU ppsspp={this.ppsspp} log={this.log} />\r\n\t\t\t\t</Route>\r\n\t\t\t\t<Route>\r\n\t\t\t\t\t<CPU ppsspp={this.ppsspp} log={this.log} />\r\n\t\t\t\t</Route>\r\n\t\t\t</Switch>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Connect automatically on start.\r\n\t\tif (!this.props.testing) {\r\n\t\t\tthis.handleAutoConnect();\r\n\t\t}\r\n\t}\r\n\r\n\thandleAutoConnect = () => {\r\n\t\tthis.connect(null);\r\n\t}\r\n\r\n\tconnect = (uri) => {\r\n\t\tthis.setState({ connecting: true });\r\n\r\n\t\tthis.ppsspp.onClose = () => {\r\n\t\t\tthis.log('Debugger disconnected');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t};\r\n\r\n\t\tlet connection;\r\n\t\tif (uri === null) {\r\n\t\t\tconnection = this.ppsspp.autoConnect();\r\n\t\t} else {\r\n\t\t\tconnection = this.ppsspp.connect(uri);\r\n\t\t}\r\n\r\n\t\tconnection.then(() => {\r\n\t\t\tthis.log('Debugger connected');\r\n\t\t\tlisteners.change(true);\r\n\t\t\tthis.setState({ connected: true, connecting: false });\r\n\t\t}, err => {\r\n\t\t\tthis.log('Debugger could not connect');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t});\r\n\t}\r\n\r\n\thandleDisconnect = () => {\r\n\t\t// Should trigger the appropriate events automatically.\r\n\t\tthis.ppsspp.disconnect();\r\n\t}\r\n\r\n\tlog = (message) => {\r\n\t\t// Would rather keep Log managing its state, and pass this callback around.\r\n\t\tif (this.logRef.current) {\r\n\t\t\tthis.logRef.current.addLogItem({ message: message + '\\n' });\r\n\t\t} else {\r\n\t\t\tconsole.error(message);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateTitle = (data) => {\r\n\t\tif (!document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.game) {\r\n\t\t\tdocument.title = this.originalTitle + ' - ' + data.game.id + ': ' + data.game.title;\r\n\t\t} else {\r\n\t\t\tdocument.title = this.originalTitle;\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange = (status) => {\r\n\t\tif (status) {\r\n\t\t\tthis.ppsspp.send({ event: 'version', ...versionInfo }).catch((err) => {\r\n\t\t\t\twindow.alert('PPSSPP seems to think this debugger is out of date.  Try refreshing?\\n\\nDetails: ' + err);\r\n\t\t\t});\r\n\t\t\tthis.ppsspp.send({ event: 'game.status' }).then(this.updateTitle, (err) => this.updateTitle({}));\r\n\t\t} else {\r\n\t\t\tthis.updateTitle({});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n\twindow.location.hostname === 'localhost' ||\r\n\t\t// [::1] is the IPv6 localhost address.\r\n\t\twindow.location.hostname === '[::1]' ||\r\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\r\n\t\twindow.location.hostname.match(\r\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n\t\t)\r\n);\r\n\r\nexport default function register() {\r\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n\t\t// The URL constructor is available in all browsers that support SW.\r\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n\t\tif (publicUrl.origin !== window.location.origin) {\r\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\r\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\r\n\t\t\t// serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('load', () => {\r\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n\t\t\tif (isLocalhost) {\r\n\t\t\t\t// This is running on localhost. Lets check if a service worker still exists or not.\r\n\t\t\t\tcheckValidServiceWorker(swUrl);\r\n\r\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\r\n\t\t\t\t// service worker/PWA documentation.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\r\n\t\t\t\t\t\t\t'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Is not local host. Just register service worker\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n\tnavigator.serviceWorker\r\n\t\t.register(swUrl)\r\n\t\t.then(registration => {\r\n\t\t\tregistration.onupdatefound = () => {\r\n\t\t\t\tconst installingWorker = registration.installing;\r\n\t\t\t\tinstallingWorker.onstatechange = () => {\r\n\t\t\t\t\tif (installingWorker.state === 'installed') {\r\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\r\n\t\t\t\t\t\t\t// At this point, the old content will have been purged and\r\n\t\t\t\t\t\t\t// the fresh content will have been added to the cache.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a \"New content is\r\n\t\t\t\t\t\t\t// available; please refresh.\" message in your web app.\r\n\t\t\t\t\t\t\tconsole.log('New content is available; please refresh.');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// At this point, everything has been precached.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a\r\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\r\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tconsole.error('Error during service worker registration:', error);\r\n\t\t});\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n\t// Check if the service worker can be found. If it can't reload the page.\r\n\tfetch(swUrl)\r\n\t\t.then(response => {\r\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\r\n\t\t\tif (\r\n\t\t\t\tresponse.status === 404 ||\r\n\t\t\t\tresponse.headers.get('content-type').indexOf('javascript') === -1\r\n\t\t\t) {\r\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\t\t\tregistration.unregister().then(() => {\r\n\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Service worker found. Proceed as normal.\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(() => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'No internet connection found. App is running in offline mode.'\r\n\t\t\t);\r\n\t\t});\r\n}\r\n\r\nexport function unregister() {\r\n\tif ('serviceWorker' in navigator) {\r\n\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\tregistration.unregister();\r\n\t\t});\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Modal from 'react-modal';\r\nimport './index.css';\r\nimport App from './components/App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport 'core-js/stable';\r\nimport 'regenerator-runtime/runtime';\r\nimport 'react-app-polyfill/ie11';\r\nimport 'react-app-polyfill/stable';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nModal.setAppElement('#root');\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}